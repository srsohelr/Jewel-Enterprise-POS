<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ক্যাশ মেমো / Cash Memo</title>
    <!-- Tailwind CSS CDN লোড করা হয়েছে দ্রুত স্টাইলিংয়ের জন্য -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter এবং Noto Sans Bengali) লোড করা হয়েছে ফন্টের জন্য -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome আইকন লোড করা হয়েছে বিভিন্ন আইকন ব্যবহারের জন্য -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* মূল বডি স্টাইল: ফন্ট, ব্যাকগ্রাউন্ড, ফ্লেক্স লেআউট (ফুটার নিচে রাখার জন্য) */
        body {
            font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
            background-color: #eef2f6; /* হালকা ব্যাকগ্রাউন্ড কালার */
            display: flex;
            flex-direction: column; /* কন্টেন্ট এবং ফুটারকে কলামে সাজানো হয়েছে */
            justify-content: space-between; /* কন্টেন্ট এবং ফুটারের মধ্যে স্থান বিতরণ */
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden; /* অনুভূমিক স্ক্রলিং প্রতিরোধ করে */
        }
        /* মূল কন্টেন্ট র‍্যাপার: সাইডবার এবং মেমো কন্টেইনারের লেআউট */
        .main-content-wrapper {
            display: flex;
            flex-direction: row; /* বড় স্ক্রিনের জন্য ডিফল্ট রো লেআউট */
            gap: 20px;
            width: 100%;
            max-width: 1200px; /* পুরো লেআউটের সর্বোচ্চ প্রস্থ */
            justify-content: center;
            align-items: flex-start;
            flex-grow: 1; /* কন্টেন্টকে বৃদ্ধি পেতে দেয় এবং ফুটারকে নিচে ঠেলে দেয় */
        }
        /* মেমো কন্টেইনারের স্টাইল */
        .memo-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); /* আরও স্পষ্ট শ্যাডো */
            width: 210mm; /* A4 কাগজের প্রস্থ */
            min-height: 297mm; /* A4 কাগজের উচ্চতা */
            padding: 25px; /* আরও ভালো দেখার জন্য প্যাডিং বাড়ানো হয়েছে */
            box-sizing: border-box;
            position: relative;
            flex-shrink: 0; /* মেমোকে ছোট হওয়া থেকে বিরত রাখে */
        }
        /* বাটন সাইডবারের স্টাইল */
        .buttons-sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px; /* বাটনগুলির মধ্যে ব্যবধান বাড়ানো হয়েছে */
            padding: 20px; /* প্যাডিং বাড়ানো হয়েছে */
            background-color: #f0f4f8; /* হালকা সাইডবার ব্যাকগ্রাউন্ড */
            border-radius: 10px; /* কিছুটা বেশি গোলাকার কোণ */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08); /* উন্নত শ্যাডো */
            width: 220px; /* কিছুটা চওড়া সাইডবার */
            flex-shrink: 0;
        }
        /* সাধারণ বাটন স্টাইল */
        .btn {
            padding: 12px 18px; /* বাটনগুলির জন্য প্যাডিং বাড়ানো হয়েছে */
            border-radius: 10px; /* আরও গোলাকার বাটন */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* সূক্ষ্ম বাটন শ্যাডো */
            border: none;
            display: flex;
            align-items: center;
            gap: 10px; /* আইকন এবং টেক্সটের মধ্যে ব্যবধান বাড়ানো হয়েছে */
            justify-content: flex-start; /* টেক্সটকে শুরুতে সারিবদ্ধ করে */
            width: 100%; /* বাটনগুলিকে সাইডবারের প্রস্থ পূর্ণ করতে দেয় */
        }
        /* বিভিন্ন বাটনের রঙের স্টাইল */
        .btn-primary { background-color: #4f46e5; color: white; }
        .btn-primary:hover { background-color: #4338ca; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-secondary { background-color: #6b7280; color: white; }
        .btn-secondary:hover { background-color: #4b5563; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-info { background-color: #0ea5e9; color: white; }
        .btn-info:hover { background-color: #0284c7; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-success { background-color: #22c55e; color: white; }
        .btn-success:hover { background-color: #16a34a; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-warning { background-color: #f97316; color: white; }
        .btn-warning:hover { background-color: #ea580c; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }

        /* ইনপুট ফিল্ডের স্টাইলিং */
        input[type="text"], input[type="number"], input[type="date"], textarea, select {
            border: 1px solid #cbd5e1; /* হালকা বর্ডার */
            border-radius: 8px; /* আরও গোলাকার ইনপুট */
            padding: 10px 14px; /* প্যাডিং বাড়ানো হয়েছে */
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #ffffff; /* সাদা ব্যাকগ্রাউন্ড নিশ্চিত করে */
        }
        /* ইনপুট ফিল্ডে ফোকাস করার সময় স্টাইল */
        input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3); /* আরও স্পষ্ট ফোকাস রিং */
        }
        /* টেবিলের স্টাইল */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px; /* মার্জিন কিছুটা বাড়ানো হয়েছে */
            font-size: 0.95em; /* টেবিলের জন্য কিছুটা বড় ফন্ট */
            border-radius: 8px; /* টেবিলের গোলাকার কোণ */
            overflow: hidden; /* গোলাকার কোণ কন্টেন্টের উপর প্রয়োগ নিশ্চিত করে */
        }
        /* টেবিল হেডার এবং সেলের স্টাইল */
        th, td {
            border: 1px solid #e2e8f0; /* হালকা টেবিল বর্ডার */
            padding: 8px 12px; /* প্যাডিং বাড়ানো হয়েছে */
            text-align: left;
        }
        /* টেবিল হেডার স্টাইল */
        th {
            background-color: #f1f5f9; /* হালকা হেডার ব্যাকগ্রাউন্ড */
            font-weight: 700; /* হেডারকে মোটা করে */
            color: #334155; /* হেডারের জন্য গাঢ় টেক্সট */
        }
        /* মোডাল (পপ-আপ) উইন্ডোর স্টাইল */
        .modal {
            display: none; /* ডিফল্টভাবে লুকানো থাকে */
            position: fixed; /* স্ক্রিনে স্থির থাকে */
            z-index: 1000; /* অন্য সবকিছুর উপরে থাকে */
            left: 0;
            top: 0;
            width: 100%; /* পুরো প্রস্থ */
            height: 100%; /* পুরো উচ্চতা */
            overflow: auto; /* প্রয়োজনে স্ক্রলবার সক্ষম করে */
            background-color: rgba(0,0,0,0.6); /* কালো রঙের আধা-স্বচ্ছ ব্যাকগ্রাউন্ড */
            justify-content: center;
            align-items: center;
        }
        /* মোডাল কন্টেন্টের স্টাইল */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 35px; /* প্যাডিং বাড়ানো হয়েছে */
            border-radius: 16px; /* আরও গোলাকার মোডাল কোণ */
            box-shadow: 0 15px 40px rgba(0,0,0,0.25); /* আরও স্পষ্ট মোডাল শ্যাডো */
            width: 90%;
            max-width: 850px; /* কিছুটা চওড়া মোডাল */
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        /* মোডাল বন্ধ করার বাটনের স্টাইল */
        .close-button {
            color: #94a3b8; /* হালকা বন্ধ বাটন কালার */
            position: absolute;
            top: 18px; /* অবস্থান সামঞ্জস্য করা হয়েছে */
            right: 25px; /* অবস্থান সামঞ্জস্য করা হয়েছে */
            font-size: 32px; /* বড় বন্ধ বাটন */
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .close-button:hover, .close-button:focus {
            color: #334155; /* হোভারে গাঢ় হয় */
            text-decoration: none;
        }

        /* মেমো হেডারের নির্দিষ্ট স্টাইল */
        .memo-header {
            background-color: #ffffff; /* সাদা ব্যাকগ্রাউন্ড */
            padding: 20px; /* প্যাডিং বাড়ানো হয়েছে */
            border-radius: 12px;
            color: #1a202c; /* টেক্সটের জন্য গাঢ় কালার */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); /* উন্নত শ্যাডো */
            margin-bottom: 25px; /* মার্জিন বাড়ানো হয়েছে */
            position: relative;
            overflow: hidden;
            border: 1px solid #e2e8f0; /* হালকা বর্ডার */
        }
        /* দোকানের নামের স্টাইল */
        .memo-header h1 {
            font-size: 2.8rem; /* কিছুটা বড় ফন্ট */
            font-weight: 800;
            margin-bottom: 8px; /* মার্জিন সামঞ্জস্য করা হয়েছে */
            color: #4f46e5; /* দোকানের নামের জন্য প্রাথমিক নীলচে রঙ */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.15); /* আরও সূক্ষ্ম শ্যাডো */
        }
        /* ঠিকানা/যোগাযোগ তথ্যের স্টাইল */
        .memo-header p {
            font-size: 0.9rem; /* কিছুটা বড় ফন্ট */
            color: #4a5568; /* ঠিকানা/যোগাযোগের জন্য কিছুটা গাঢ় ধূসর */
            line-height: 1.4; /* লাইন উচ্চতা সামঞ্জস্য করা হয়েছে */
        }
        /* লোগোর স্টাইল */
        .memo-header img {
            border: 4px solid rgba(79, 70, 229, 0.2); /* হালকা নীলচে বর্ডার */
            box-shadow: 0 0 12px rgba(0,0,0,0.1); /* উন্নত শ্যাডো */
            height: 90px; /* কিছুটা বড় লোগো */
            margin-bottom: 15px; /* মার্জিন সামঞ্জস্য করা হয়েছে */
        }

        /* প্রিন্ট করার জন্য নির্দিষ্ট স্টাইল */
        @media print {
            body {
                background-color: #fff;
                margin: 0;
                padding: 0;
                display: block; /* প্রিন্টের জন্য ফ্লেক্স ওভাররাইড করে */
            }
            .main-content-wrapper {
                display: block; /* প্রিন্টের সময় সাইдবার এবং ড্যাশবোর্ড লুকায় */
                width: auto;
                max-width: none;
                gap: 0;
            }
            .memo-container {
                box-shadow: none;
                border-radius: 0;
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto; /* A4 পেজের কেন্দ্রে মেমো রাখে */
                padding: 10mm; /* A4 মার্জিন কমানো হয়েছে আরও কন্টেন্টের জন্য */
            }
            /* প্রিন্টের সময় লুকানো উপাদান */
            .buttons-sidebar, .language-toggle, .modal, .dashboard-panel, .print-hidden, .signature-controls, .memo-bottom-buttons, .dashboard-button-main, .scrolling-text-footer {
                display: none !important;
            }
            /* নিশ্চিত করে যে দোকানের সমস্ত তথ্য হেডারে প্রিন্টের জন্য দৃশ্যমান */
            .memo-header .print-hidden-except-shop-name {
                display: block !important; /* এগুলো দৃশ্যমান নিশ্চিত করে */
            }
            .memo-header {
                text-align: center !important;
                padding: 5px 0 !important; /* প্যাডিং আরও কমানো হয়েছে */
                margin-bottom: 10px !important; /* মার্জিন আরও কমানো হয়েছে */
                box-shadow: none !important;
                border: none !important;
            }
            .memo-header h1 {
                font-size: 2.2rem !important; /* প্রিন্টের জন্য ফন্ট সাইজ সামঞ্জস্য করা হয়েছে */
                margin-bottom: 0 !important;
                color: #000 !important; /* প্রিন্টের জন্য কালো টেক্সট */
                text-shadow: none !important;
            }
            .memo-header p {
                font-size: 0.75rem !important; /* প্রিন্টে বিবরণের জন্য ছোট ফন্ট */
                color: #000 !important;
            }
            .memo-header img {
                height: 60px !important; /* প্রিন্টের জন্য ছোট লোগো */
                margin-bottom: 5px !important;
            }
            /* নিশ্চিত করে যে টেবিল বর্ডার প্রিন্টে দৃশ্যমান */
            table, th, td {
                border: 1px solid #000 !important;
                font-size: 0.8em !important; /* টেবিল কন্টেন্টের জন্য ছোট ফন্ট */
                padding: 4px 6px !important; /* টেবিল সেলের জন্য প্যাডিং কমানো হয়েছে */
            }
            /* নিশ্চিত করে যে ইনপুটগুলি ইনপুট ফিল্ড হিসাবে দৃশ্যমান নয়, তবে তাদের টেক্সট কন্টেন্ট দৃশ্যমান */
            input, textarea {
                border: none !important;
                background: none !important;
                padding: 0 !important;
            }
            /* নিশ্চিত করে যে টেক্সট কন্টেন্ট প্রিন্টের জন্য দৃশ্যমান */
            input[type="text"]::placeholder,
            input[type="number"]::placeholder,
            input[type="date"]::placeholder,
            textarea::placeholder {
                color: transparent; /* প্লেসহোল্ডার টেক্সট লুকায় */
            }
            input[type="text"]:not([value=""])::before,
            input[type="number"]:not([value=""])::before,
            input[type="date"]:not([value=""])::before,
            textarea:not(:empty)::before {
                content: attr(value) !important; /* আসল মান প্রদর্শন করে */
                display: block;
            }
            /* তারিখ ইনপুট টেক্সট দেখানোর জন্য নির্দিষ্ট হ্যান্ডলিং */
            input[type="date"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            /* নিশ্চিত করে যে স্বাক্ষরের লাইন দৃশ্যমান */
            .border-t {
                border-top: 1px solid #000 !important;
            }
            .signature-area {
                border-top: 1px dashed #000 !important; /* নিশ্চিত করে যে স্বাক্ষরের লাইন প্রিন্ট হয় */
                margin-top: 20px !important; /* মার্জিন কমানো হয়েছে */
                margin-bottom: 10px !important;
            }
            .signature-area p {
                font-size: 0.8em !important;
            }
            .customer-details-grid {
                margin-bottom: 5px !important; /* মার্জিন কমানো হয়েছে */
            }
            .customer-details-grid > div {
                margin-bottom: 2px !important; /* মার্জিন কমানো হয়েছে */
            }
            .memo-field-label {
                margin-bottom: 2px !important; /* মার্জিন কমানো হয়েছে */
            }
        }

        /* রেসপনসিভ সামঞ্জস্য */
        @media (max-width: 1024px) { /* সাইডবার স্ট্যাকিংয়ের জন্য ব্রেকপয়েন্ট সামঞ্জস্য করা হয়েছে */
            .main-content-wrapper {
                flex-direction: column; /* মেমো এবং বাটন উল্লম্বভাবে স্ট্যাক করে */
                align-items: center;
            }
            .memo-container {
                width: 100%;
                max-width: 210mm; /* মেমোর জন্য A4 প্রস্থ রাখে */
                padding: 15px;
            }
            .buttons-sidebar {
                width: 100%; /* সাইডবারকে পুরো প্রস্থ দেয় */
                flex-direction: row; /* বাটনগুলি অনুভূমিকভাবে প্রবাহিত হতে বা মোড়ানো হতে পারে */
                flex-wrap: wrap;
                justify-content: center;
            }
            .btn {
                width: auto; /* স্ট্যাক করা বাটনের জন্য অটো প্রস্থ */
                flex-grow: 1; /* বাটনগুলিকে বৃদ্ধি পেতে দেয় */
                justify-content: center;
            }
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
        /* কাস্টমার বিবরণের ব্যবধান কমানো */
        .customer-details-grid {
            margin-bottom: 10px; /* কাস্টমার বিবরণের নিচে সামঞ্জস্যপূর্ণ ব্যবধান */
        }
        .customer-details-grid > div {
            margin-bottom: 5px; /* পৃথক কাস্টমার ফিল্ডের মধ্যে সামঞ্জস্যপূর্ণ ব্যবধান */
        }
        .memo-field-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 4px;
            display: block;
        }
        /* ড্যাশবোর্ডের নির্দিষ্ট স্টাইল */
        .dashboard-info-box {
            transition: all 0.3s ease;
            background-color: #f8f8f8; /* হালকা ব্যাকগ্রাউন্ড */
            border: 1px solid #e0e0e0;
        }
        .dashboard-info-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        .dashboard-product-stock-table tbody tr:nth-child(odd) {
            background-color: #f9fafb; /* বিজোড় সারির জন্য হালকা ধূসর */
        }
        .dashboard-product-stock-table tbody tr:hover {
            background-color: #f3f4f6; /* হোভারে কিছুটা গাঢ় হয় */
        }
        .low-stock {
            color: #ef4444; /* কম স্টকের জন্য লাল রঙ */
            font-weight: 600;
        }

        /* ডেভেলপার তথ্য মোডাল অ্যানিমেশন */
        @keyframes slideInFromLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .developer-info-modal-content {
            animation: fadeInScale 0.5s ease-out;
        }
        .developer-info-text {
            font-size: 1.8rem; /* বড় ফন্ট */
            font-weight: 700;
            color: #4f46e5; /* নীলচে রঙে পরিবর্তন করা হয়েছে */
            text-shadow: 0 0 8px rgba(79, 70, 229, 0.5), 0 0 15px rgba(79, 70, 229, 0.3); /* নীলচে আভা */
            animation: slideInFromLeft 0.7s ease-out forwards;
            opacity: 0; /* শুরুতে লুকানো থাকে */
        }
        .developer-info-text:nth-child(1) { animation-delay: 0.1s; }
        .developer-info-text:nth-child(2) { animation-delay: 0.2s; }
        .developer-info-text:nth-child(3) { animation-delay: 0.3s; }
        .developer-info-text:nth-child(4) { animation-delay: 0.4s; }

        /* মোডালের ভিতরের ফর্মের স্টাইল */
        .modal-content form {
            background-color: #f8fafc; /* খুব হালকা নীলচে-ধূসর ব্যাকগ্রাউন্ড */
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        .modal-content table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .modal-content table th {
            background-color: #eef2f6;
        }
        .modal-content table td {
            background-color: #ffffff;
        }
        /* পণ্য ব্যবস্থাপনায় ছবির প্রিভিউ */
        .product-image-preview {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid #e2e8f0;
        }

        /* স্ক্রলিং টেক্সট ফুটার */
        .scrolling-text-footer {
            width: 100%;
            background-color: #4f46e5; /* নীলচে ব্যাকগ্রাউন্ড */
            color: white;
            padding: 10px 0;
            margin-top: 20px; /* মূল কন্টেন্ট থেকে ব্যবধান */
            overflow: hidden; /* মার্কি ইফেক্টের জন্য ওভারফ্লো লুকায় */
            white-space: nowrap; /* টেক্সট মোড়ানো প্রতিরোধ করে */
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1); /* উপরে সূক্ষ্ম শ্যাডো */
            position: relative; /* হোভার তথ্যের অবস্থানের জন্য */
        }

        .scrolling-text-footer .marquee {
            display: inline-block;
            padding-left: 100%; /* টেক্সটকে স্ক্রিনের ডান পাশ থেকে শুরু করে */
            animation: marquee 15s linear infinite; /* প্রয়োজন অনুযায়ী সময় সামঞ্জস্য করুন */
            font-size: 1.5rem; /* স্বাগতম টেক্সটের জন্য বড় ফন্ট */
            font-weight: 600;
        }

        @keyframes marquee {
            0%   { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); } /* টেক্সটকে পুরো স্ক্রিনের বাম পাশে সরিয়ে দেয় */
        }

        /* হোভারে ডেভেলপার তথ্য */
        .developer-info-hover {
            position: absolute;
            bottom: 100%; /* ফুটারের উপরে অবস্থান */
            left: 50%;
            transform: translate(-50%, 10px) scale(0.95); /* প্রাথমিক অবস্থান কিছুটা নিচে এবং ছোট */
            margin-bottom: 8px; /* ফুটার এবং টুলটিপের মধ্যে ব্যবধান */
            padding: 15px 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-out; /* সমস্ত বৈশিষ্ট্যের জন্য মসৃণ ট্রানজিশন */
            z-index: 1001; /* অন্যান্য কন্টেন্টের উপরে নিশ্চিত করে */
            min-width: 250px; /* পর্যাপ্ত প্রস্থ নিশ্চিত করে */
            white-space: normal; /* টেক্সটকে মোড়ানো অনুমোদন করে */
            text-align: left;
            pointer-events: none; /* লুকানো অবস্থায় ক্লিক পাস করতে দেয় */
        }

        .scrolling-text-footer:hover .developer-info-hover {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, 0) scale(1); /* উপরে চলে আসে এবং ১০০% স্কেল হয় */
            pointer-events: auto; /* দৃশ্যমান হলে ক্লিক সক্ষম করে */
        }

        .developer-info-hover p {
            color: #334155;
            line-height: 1.4;
        }
        .developer-info-hover p:first-child {
            font-size: 1.1rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 5px;
        }

        /* প্রিন্টের সময় এই হোভার তথ্য লুকায় */
        @media print {
            .developer-info-hover {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center">

    <div class="main-content-wrapper">
        <!-- বাটন সাইডবার: অ্যাপ্লিকেশনের প্রধান নেভিগেশন বাটনগুলি এখানে থাকে -->
        <div class="buttons-sidebar">
            <button id="languageToggle" class="btn btn-info">
                <i class="fas fa-language"></i> <span id="languageToggleText">English</span>
            </button>
            <button id="homeBtn" class="btn btn-info"><i class="fas fa-file-invoice"></i> <span data-lang-key="homeBtn">হোম</span></button>
            <button id="dashboardBtnMain" class="btn btn-primary"><i class="fas fa-tachometer-alt"></i> <span data-lang-key="dashboardBtn">ড্যাশবোর্ড</span></button>
            <button id="accountingBtn" class="btn btn-success"><i class="fas fa-calculator"></i> <span data-lang-key="accountingBtn">হিসাবরক্ষণ</span></button>
            <button id="historyBtn" class="btn btn-warning"><i class="fas fa-history"></i> <span data-lang-key="historyBtn">পূর্বের মেমো</span></button>
            <button id="salesReportBtn" class="btn btn-primary"><i class="fas fa-chart-bar"></i> <span data-lang-key="salesReportBtn">বিক্রয় রিপোর্ট</span></button>
            <button id="manageCustomersBtn" class="btn btn-info"><i class="fas fa-users"></i> <span data-lang-key="manageCustomersBtn">কাস্টমার ম্যানেজ করুন</span></button>
            <button id="manageProductsBtn" class="btn btn-info"><i class="fas fa-boxes"></i> <span data-lang-key="manageProductsBtn">পণ্য ম্যানেজ করুন</span></button>
            <button id="importDataBtn" class="btn btn-secondary"><i class="fas fa-file-import"></i> <span data-lang-key="importDataBtn">ডেটা ইম্পোর্ট</span></button>
            <button id="exportDataBtn" class="btn btn-secondary"><i class="fas fa-file-export"></i> <span data-lang-key="exportDataBtn">ডেটা এক্সপোর্ট</span></button>
            <button id="changePasswordBtn" class="btn btn-secondary"><i class="fas fa-key"></i> <span data-lang-key="changePasswordBtn">পাসওয়ার্ড পরিবর্তন করুন</span></button>
            <button id="developerInfoBtn" class="btn btn-info"><i class="fas fa-code"></i> <span data-lang-key="developerInfoBtn">ডেভলপার তথ্য</span></button>
        </div>

        <!-- মেমো কন্টেইনার: এখানে ক্যাশ মেমোর মূল ফর্ম এবং প্রিন্ট করার যোগ্য অংশ থাকে -->
        <div class="memo-container relative">
            <div class="print-area">
                <!-- দোকানের হেডার অংশ -->
                <div class="text-center mb-6 memo-header">
                    <img id="companyLogo" src="https://raw.githubusercontent.com/srsohelr/-sr-computer-website/refs/heads/main/Copy%20(2)%20of%2012742392_907086682746179_1795963022629218822_n.jpg" alt="Company Logo" class="mx-auto h-20 mb-3 rounded-full">
                    <h1 id="shopName" class="text-3xl font-extrabold mb-1">জুয়েল এন্টারপ্রাইজ</h1>
                    <p id="shopAddress" class="text-sm mb-0.5">বিসমিল্লা কমপ্লেক্স, ইনিয়ন পরিষদের সামনে, ডিমলা, নীলফামারী</p>
                    <p id="shopMobile" class="text-sm mb-0.5">মোবাইল নং: 01711472098</p>
                    <p id="shopEmail" class="text-sm">ইমেইল: jepdimla98@gmail.com</p>
                </div>

                <!-- মেমো বিবরণ এবং ক্রেতার তথ্য -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 mb-4 customer-details-grid">
                    <div>
                        <label for="memoNo" class="memo-field-label text-sm" data-lang-key="memoNoLabel">মেমো নং:</label>
                        <input type="text" id="memoNo" class="w-full text-sm py-1 px-2" readonly>
                        <button id="manualMemoNoToggle" class="text-xs text-indigo-600 mt-0.5 hover:underline" data-lang-key="manualMemoNoToggle">ম্যানুয়ালি পরিবর্তন করুন</button>
                    </div>
                    <div>
                        <label for="memoDate" class="memo-field-label text-sm" data-lang-key="dateLabel">তারিখ:</label>
                        <input type="date" id="memoDate" class="w-full text-sm py-1 px-2">
                    </div>
                    <div class="md:col-span-2">
                        <label for="customerName" class="memo-field-label text-sm" data-lang-key="customerNameLabel">ক্রেতার নাম:</label>
                        <input type="text" id="customerName" class="w-full text-sm py-1 px-2" list="customerNames">
                        <datalist id="customerNames"></datalist>
                    </div>
                    <div class="md:col-span-2">
                        <label for="customerAddress" class="memo-field-label text-sm" data-lang-key="customerAddressLabel">ঠিকানা:</label>
                        <input type="text" id="customerAddress" class="w-full text-sm py-1 px-2">
                    </div>
                    <div class="md:col-span-2">
                        <label for="customerMobile" class="memo-field-label text-sm" data-lang-key="customerMobileLabel">মোবাইল নং:</label>
                        <input type="text" id="customerMobile" class="w-full text-sm py-1 px-2">
                    </div>
                </div>

                <!-- পণ্যের টেবিল -->
                <div class="overflow-x-auto mb-4">
                    <table class="min-w-full bg-white rounded-lg shadow-sm">
                        <thead>
                            <tr>
                                <th class="py-1.5 px-2 text-sm" data-lang-key="slNoHeader">ক্রমিক নং</th>
                                <th class="py-1.5 px-2 text-sm" data-lang-key="descriptionHeader">বিবরণ</th>
                                <th class="py-1.5 px-2 text-sm" data-lang-key="quantityHeader">পরিমাণ</th>
                                <th class="py-1.5 px-2 text-sm" data-lang-key="rateHeader">দাম</th>
                                <th class="py-1.5 px-2 text-sm" data-lang-key="amountHeader">টাকা</th>
                                <th class="py-1.5 px-2 text-sm print-hidden" data-lang-key="actionHeader">অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                            <!-- পণ্যের সারিগুলো জাভাস্ক্রিপ্ট দিয়ে এখানে যোগ করা হবে -->
                        </tbody>
                    </table>
                </div>
                <button id="addProductBtn" class="btn btn-success mb-4 print-hidden py-1.5 px-3 text-sm">
                    <i class="fas fa-plus-circle"></i> <span data-lang-key="addProductBtn">পণ্য যোগ করুন</span>
                </button>

                <!-- মোট হিসাব এবং ডিসকাউন্ট -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 mb-4">
                    <div class="md:col-span-1">
                        <label for="subTotal" class="memo-field-label text-sm" data-lang-key="subTotalLabel">মোট টাকা (সাব-টোটাল):</label>
                        <input type="text" id="subTotal" class="w-full bg-gray-100 text-sm py-1 px-2" readonly>
                    </div>
                    <div class="md:col-span-1">
                        <label for="discount" class="memo-field-label text-sm" data-lang-key="discountLabel">ডিসকাউন্ট (%):</label>
                        <input type="number" id="discount" class="w-full text-sm py-1 px-2" value="0">
                    </div>
                    <div class="md:col-span-2">
                        <label for="grandTotal" class="memo-field-label text-sm" data-lang-key="grandTotalLabel">সর্বমোট টাকা:</label>
                        <input type="text" id="grandTotal" class="w-full bg-indigo-50 font-bold text-base py-1.5 px-2" readonly>
                    </div>
                    <div class="md:col-span-2">
                        <label for="amountInWords" class="memo-field-label text-sm" data-lang-key="amountInWordsLabel">কথায়:</label>
                        <textarea id="amountInWords" class="w-full h-16 bg-gray-100 text-sm py-1 px-2" readonly></textarea>
                    </div>
                    <div class="md:col-span-1">
                        <label for="paidAmount" class="memo-field-label text-sm" data-lang-key="paidAmountLabel">পরিশোধিত টাকা:</label>
                        <input type="number" id="paidAmount" class="w-full text-sm py-1 px-2" value="0" min="0" step="0.01">
                    </div>
                    <div class="md:col-span-1">
                        <label for="dueAmount" class="memo-field-label text-sm" data-lang-key="dueAmountLabel">বাকি টাকা:</label>
                        <input type="text" id="dueAmount" class="w-full bg-red-50 font-bold text-base py-1.5 px-2" readonly>
                    </div>
                </div>

                <!-- স্বাক্ষর স্থান -->
                <div class="flex justify-between items-end mt-8 mb-4">
                    <div class="text-center">
                        <p class="border-t border-gray-400 pt-1 text-gray-700 text-sm" data-lang-key="buyerSignature">ক্রেতার স্বাক্ষর</p>
                    </div>
                    <div class="text-center">
                        <p class="border-t border-gray-400 pt-1 text-gray-700 text-sm" data-lang-key="sellerSignature">বিক্রেতার স্বাক্ষর</p>
                    </div>
                </div>

                <!-- মেমোর নিচের অংশে প্রিন্ট এবং সেভ বাটন -->
                <div class="memo-bottom-buttons flex justify-center gap-4 mt-6 print-hidden">
                    <button id="saveMemoBottomBtn" class="btn btn-success py-1.5 px-3 text-sm"><i class="fas fa-save"></i> <span data-lang-key="saveMemoBtn">সংরক্ষণ করুন</span></button>
                    <button id="printMemoBottomBtn" class="btn btn-primary py-1.5 px-3 text-sm"><i class="fas fa-print"></i> <span data-lang-key="printMemoBtn">প্রিন্ট</span></button>
                    <button id="resetMemoBottomBtn" class="btn btn-secondary py-1.5 px-3 text-sm"><i class="fas fa-redo"></i> <span data-lang-key="refreshMemoBtn">রিসেট</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- ড্যাশবোর্ড মোডাল (এখন হোম পেজ হিসাবে কাজ করে) -->
    <div id="dashboardModal" class="modal">
        <div class="modal-content max-w-4xl">
            <span class="close-button" id="closeDashboardModal">&times;</span>
            <h2 class="text-3xl font-bold mb-6 text-indigo-700 text-center" data-lang-key="dashboardTitle">ড্যাশবোর্ড</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-blue-100 p-6 rounded-lg shadow-md flex flex-col items-center justify-center dashboard-info-box">
                    <i class="fas fa-file-invoice text-4xl text-blue-600 mb-3"></i>
                    <p class="text-lg font-semibold text-gray-700" data-lang-key="totalMemos">মোট মেমো:</p>
                    <p class="text-5xl font-extrabold text-blue-800" id="totalMemosValue">0</p>
                </div>
                <div class="bg-green-100 p-6 rounded-lg shadow-md flex flex-col items-center justify-center dashboard-info-box">
                    <i class="fas fa-users text-4xl text-green-600 mb-3"></i>
                    <p class="text-lg font-semibold text-gray-700" data-lang-key="totalCustomers">মোট কাস্টমার:</p>
                    <p class="text-5xl font-extrabold text-green-800" id="totalCustomersValue">0</p>
                </div>
                <div class="bg-purple-100 p-6 rounded-lg shadow-md flex flex-col items-center justify-center dashboard-info-box">
                    <i class="fas fa-boxes text-4xl text-purple-600 mb-3"></i>
                    <p class="text-lg font-semibold text-gray-700" data-lang-key="totalProducts">মোট পণ্য:</p>
                    <p class="text-5xl font-extrabold text-purple-800" id="totalProductsValue">0</p>
                </div>
                <div class="bg-yellow-100 p-6 rounded-lg shadow-md flex flex-col items-center justify-center dashboard-info-box">
                    <i class="fas fa-money-bill-wave text-4xl text-yellow-600 mb-3"></i>
                    <p class="text-lg font-semibold text-gray-700" data-lang-key="totalSalesAmount">মোট বিক্রয়:</p>
                    <p class="text-5xl font-extrabold text-yellow-800" id="totalSalesAmountValue">0.00</p>
                </div>
            </div>

            <h3 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="productStockTitle">পণ্য স্টক</h3>
            <div class="overflow-x-auto border border-gray-200 rounded-lg shadow-sm">
                <table class="min-w-full bg-white dashboard-product-stock-table">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang-key="descriptionHeader">বিবরণ</th>
                            <th class="py-3 px-4 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang-key="sellingRateLabel">বিক্রয় দাম</th>
                            <th class="py-3 px-4 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-lang-key="stockLabel">স্টক</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardProductStockTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- পণ্যের স্টক এখানে লোড করা হবে -->
                    </tbody>
                </table>
            </div>

            <div class="dashboard-quick-links mt-8 w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button id="dashboardHistoryBtn" class="btn btn-warning"><i class="fas fa-history"></i> <span data-lang-key="historyBtn">পূর্বের মেমো</span></button>
                <button id="dashboardSalesReportBtn" class="btn btn-primary"><i class="fas fa-chart-bar"></i> <span data-lang-key="salesReportBtn">বিক্রয় রিপোর্ট</span></button>
                <button id="dashboardManageCustomersBtn" class="btn btn-info"><i class="fas fa-users"></i> <span data-lang-key="manageCustomersBtn">কাস্টমার ম্যানেজ করুন</span></button>
                <button id="dashboardManageProductsBtn" class="btn btn-info"><i class="fas fa-boxes"></i> <span data-lang-key="manageProductsBtn">পণ্য ম্যানেজ করুন</span></button>
                <button id="dashboardImportDataBtn" class="btn btn-secondary"><i class="fas fa-file-import"></i> <span data-lang-key="importDataBtn">ডেটা ইম্পোর্ট</span></button>
                <button id="dashboardExportDataBtn" class="btn btn-secondary"><i class="fas fa-file-export"></i> <span data-lang-key="exportDataBtn">ডেটা এক্সপোর্ট</span></button>
            </div>
        </div>
    </div>

    <!-- হিস্টোরি মোডাল: পূর্বের মেমো দেখার জন্য -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeHistoryModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="historyTitle">মেমো হিস্টোরি</h2>
            <input type="text" id="historySearchInput" class="w-full mb-4 p-2 border rounded" placeholder="মেমো নং বা ক্রেতার নাম দিয়ে খুঁজুন..." data-lang-key="historySearchPlaceholder">
            <div id="historyList" class="max-h-96 overflow-y-auto border border-gray-200 rounded p-2">
                <!-- হিস্টোরি আইটেমগুলো এখানে লোড করা হবে -->
            </div>
        </div>
    </div>

    <!-- বিক্রয় রিপোর্ট মোডাল -->
    <div id="salesReportModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeSalesReportModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="salesReportTitle">বিক্রয় রিপোর্ট</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="reportStartDate" class="block text-gray-700 font-semibold mb-1" data-lang-key="startDateLabel">শুরুর তারিখ:</label>
                    <input type="date" id="reportStartDate" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label for="reportEndDate" class="block text-gray-700 font-semibold mb-1" data-lang-key="endDateLabel">শেষের তারিখ:</label>
                    <input type="date" id="reportEndDate" class="w-full p-2 border rounded">
                </div>
            </div>
            <button id="generateReportBtn" class="btn btn-primary mb-4 w-full" data-lang-key="generateReportBtn">রিপোর্ট তৈরি করুন</button>
            <div id="reportContent" class="max-h-96 overflow-y-auto border border-gray-200 rounded p-4 mb-4">
                <!-- রিপোর্ট কন্টেন্ট এখানে দেখানো হবে -->
            </div>
            <button id="printReportBtn" class="btn btn-secondary w-full" data-lang-key="printReportBtn">রিপোর্ট প্রিন্ট করুন</button>
        </div>
    </div>

    <!-- কাস্টমার ম্যানেজমেন্ট মোডাল -->
    <div id="customerManagementModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeCustomerManagementModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="customerManagementTitle">কাস্টমার ম্যানেজ করুন</h2>
            <form id="customerForm" class="mb-4 p-4 border rounded-lg bg-gray-50">
                <input type="hidden" id="customerId">
                <label for="customerMgtName" class="block text-gray-700 font-semibold mb-1" data-lang-key="customerNameLabel">ক্রেতার নাম:</label>
                <input type="text" id="customerMgtName" class="w-full mb-2" required>
                <label for="customerMgtAddress" class="block text-gray-700 font-semibold mb-1" data-lang-key="customerAddressLabel">ঠিকানা:</label>
                <input type="text" id="customerMgtAddress" class="w-full mb-2">
                <label for="customerMgtMobile" class="block text-gray-700 font-semibold mb-1" data-lang-key="customerMgtMobileLabel">মোবাইল নং:</label>
                <input type="text" id="customerMgtMobile" class="w-full mb-4">
                <button type="submit" class="btn btn-success w-full" id="saveCustomerBtn" data-lang-key="saveCustomerBtn">কাস্টমার সেভ করুন</button>
            </form>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg shadow-sm">
                    <thead>
                        <tr>
                            <th class="py-2 px-4">ক্রমিক নং</th>
                            <th class="py-2 px-4" data-lang-key="customerNameLabel">ক্রেতার নাম</th>
                            <th class="py-2 px-4" data-lang-key="customerAddressLabel">ঠিকানা</th>
                            <th class="py-2 px-4" data-lang-key="customerMobileLabel">মোবাইল নং</th>
                            <th class="py-2 px-4" data-lang-key="actionHeader">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                        <!-- কাস্টমার তালিকা এখানে লোড করা হবে -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- পণ্য ম্যানেজমেন্ট মোডাল -->
    <div id="productManagementModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeProductManagementModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="productManagementTitle">পণ্য ম্যানেজ করুন</h2>
            <form id="productForm" class="mb-4 p-4 border rounded-lg bg-gray-50">
                <input type="hidden" id="productId">
                <label for="productMgtCode" class="block text-gray-700 font-semibold mb-1" data-lang-key="productCodeLabel">প্রোডাক্ট কোড:</label>
                <input type="text" id="productMgtCode" class="w-full mb-2" required>
                <label for="productMgtDescription" class="block text-gray-700 font-semibold mb-1" data-lang-key="descriptionHeader">বিবরণ:</label>
                <input type="text" id="productMgtDescription" class="w-full mb-2" required>
                <label for="productMgtPurchaseRate" class="block text-gray-700 font-semibold mb-1" data-lang-key="purchaseRateLabel">কেনা দাম:</label>
                <input type="number" id="productMgtPurchaseRate" class="w-full mb-2" min="0" step="0.01" required>
                <label for="productMgtRate" class="block text-gray-700 font-semibold mb-1" data-lang-key="sellingRateLabel">বিক্রয় দাম:</label>
                <input type="number" id="productMgtRate" class="w-full mb-2" min="0" step="0.01" required>
                <label for="productMgtStock" class="block text-gray-700 font-semibold mb-1" data-lang-key="stockLabel">স্টক যোগ করুন:</label>
                <input type="number" id="productMgtStock" class="w-full mb-2" min="0" value="0" required>
                <label for="productMgtImageUrl" class="block text-gray-700 font-semibold mb-1" data-lang-key="imageUrlLabel">ছবির URL (ঐচ্ছিক):</label>
                <input type="text" id="productMgtImageUrl" class="w-full mb-4" placeholder="পণ্যের ছবির URL">
                <button type="submit" class="btn btn-success w-full" id="saveProductBtn" data-lang-key="saveProductBtn">পণ্য সেভ করুন</button>
            </form>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg shadow-sm">
                    <thead>
                        <tr>
                            <th class="py-2 px-4">ক্রমিক নং</th>
                            <th class="py-2 px-4" data-lang-key="productCodeLabel">কোড</th>
                            <th class="py-2 px-4" data-lang-key="descriptionHeader">বিবরণ</th>
                            <th class="py-2 px-4" data-lang-key="purchaseRateLabel">কেনা দাম</th>
                            <th class="py-2 px-4" data-lang-key="sellingRateLabel">বিক্রয় দাম</th>
                            <th class="py-2 px-4" data-lang-key="currentStockLabel">বর্তমান স্টক</th>
                            <th class="py-2 px-4" data-lang-key="actionHeader">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBodyMgt">
                        <!-- পণ্যের তালিকা এখানে লোড করা হবে -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- স্টক ইতিহাস মোডাল -->
    <div id="stockHistoryModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeStockHistoryModal">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="stockHistoryTitle">স্টক ইতিহাস</h2>
            <h3 id="stockHistoryProductName" class="text-xl font-semibold mb-4"></h3>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg shadow-sm">
                    <thead>
                        <tr>
                            <th class="py-2 px-4" data-lang-key="dateLabel">তারিখ</th>
                            <th class="py-2 px-4" data-lang-key="typeLabel">ধরণ</th>
                            <th class="py-2 px-4" data-lang-key="quantityHeader">পরিমাণ</th>
                            <th class="py-2 px-4" data-lang-key="memoNoLabel">মেমো নং</th>
                        </tr>
                    </thead>
                    <tbody id="stockHistoryTableBody">
                        <!-- স্টক ইতিহাস এখানে লোড করা হবে -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ডেভেলপার তথ্য মোডাল -->
    <div id="developerInfoModal" class="modal">
        <div class="modal-content max-w-md text-center developer-info-modal-content">
            <span class="close-button" id="closeDeveloperInfoModal">&times;</span>
            <h2 class="text-3xl font-bold mb-6 text-indigo-700" data-lang-key="developerInfoTitle">ডেভলপার তথ্য</h2>
            <p class="text-xl font-semibold mb-2 developer-info-text">নাম: SOHEL RANA</p>
            <p class="text-lg mb-2 developer-info-text">পদবি: কম্পিউটার অপারেটর</p>
            <p class="text-lg mb-2 developer-info-text">সংস্থা: জুয়েল এন্টারপ্রাইজ</p>
            <p class="text-lg developer-info-text">স্থান: ডিমলা, নীলফামারী</p>
        </div>
    </div>

    <!-- অ্যাকাউন্টিং মোডাল: দৈনিক আয়-ব্যয়ের তথ্য ইনপুট এবং রিপোর্ট দেখার জন্য -->
    <div id="accountingModal" class="modal">
        <div class="modal-content max-w-4xl">
            <span class="close-button" id="closeAccountingModal">&times;</span>
            <h2 class="text-3xl font-bold mb-6 text-indigo-700 text-center" data-lang-key="accountingTitle">দৈনিক আয়-ব্যয়ের তথ্য</h2>

            <!-- আয়-ব্যয় ইনপুট ফর্ম -->
            <form id="accountingForm" class="mb-8 p-6 border rounded-lg bg-gray-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="accountingSlNo" class="block text-gray-700 font-semibold mb-1" data-lang-key="slNoHeader">ক্রমিক নং:</label>
                        <input type="text" id="accountingSlNo" class="w-full bg-gray-100" readonly>
                    </div>
                    <div>
                        <label for="accountingDate" class="block text-gray-700 font-semibold mb-1" data-lang-key="dateLabel">তারিখ:</label>
                        <input type="date" id="accountingDate" class="w-full" required>
                    </div>
                    <div>
                        <label for="accountingIncome" class="block text-gray-700 font-semibold mb-1" data-lang-key="incomeLabel">আয়:</label>
                        <input type="number" id="accountingIncome" class="w-full" value="0" min="0" step="0.01">
                    </div>
                    <div>
                        <label for="accountingExpense" class="block text-gray-700 font-semibold mb-1" data-lang-key="expenseLabel">ব্যয়:</label>
                        <input type="number" id="accountingExpense" class="w-full" value="0" min="0" step="0.01">
                    </div>
                    <div class="md:col-span-2">
                        <label for="accountingExpenseCategory" class="block text-gray-700 font-semibold mb-1" data-lang-key="expenseCategoryLabel">ব্যয়ের খাত:</label>
                        <input type="text" id="accountingExpenseCategory" class="w-full">
                    </div>
                    <div class="md:col-span-2">
                        <label for="accountingComment" class="block text-gray-700 font-semibold mb-1" data-lang-key="commentLabel">মন্তব্য:</label>
                        <textarea id="accountingComment" class="w-full h-20"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-full" data-lang-key="addEntryBtn">এন্ট্রি যোগ করুন</button>
            </form>

            <!-- রিপোর্ট ফিল্টার এবং বাটন -->
            <h3 class="text-2xl font-bold mb-4 text-indigo-700" data-lang-key="accountingReportTitle">আয়-ব্যয় রিপোর্ট</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="accountingReportStartDate" class="block text-gray-700 font-semibold mb-1" data-lang-key="startDateLabel">শুরুর তারিখ:</label>
                    <input type="date" id="accountingReportStartDate" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label for="accountingReportEndDate" class="block text-gray-700 font-semibold mb-1" data-lang-key="endDateLabel">শেষের তারিখ:</label>
                    <input type="date" id="accountingReportEndDate" class="w-full p-2 border rounded">
                </div>
            </div>
            <div class="flex flex-wrap gap-2 mb-4">
                <button id="accountingReport7DaysBtn" class="btn btn-secondary text-sm px-3 py-1.5" data-lang-key="last7DaysBtn">গত ৭ দিন</button>
                <button id="accountingReportThisMonthBtn" class="btn btn-secondary text-sm px-3 py-1.5" data-lang-key="thisMonthBtn">এই মাস</button>
                <button id="accountingReportLastMonthBtn" class="btn btn-secondary text-sm px-3 py-1.5" data-lang-key="lastMonthBtn">গত মাস</button>
                <button id="generateAccountingReportBtn" class="btn btn-primary flex-grow" data-lang-key="generateReportBtn">রিপোর্ট তৈরি করুন</button>
            </div>
            
            <!-- আয়-ব্যয় রিপোর্ট কন্টেন্ট -->
            <div id="accountingReportContent" class="max-h-96 overflow-y-auto border border-gray-200 rounded p-4 mb-4">
                <!-- রিপোর্ট এখানে লোড করা হবে -->
            </div>
            <button id="printAccountingReportBtn" class="btn btn-secondary w-full" data-lang-key="printReportBtn">রিপোর্ট প্রিন্ট করুন</button>
        </div>
    </div>

    <!-- পাসওয়ার্ড মোডাল -->
    <div id="passwordModal" class="modal">
        <div class="modal-content max-w-sm text-center">
            <h2 class="text-xl font-bold mb-4 text-indigo-700" data-lang-key="passwordPromptTitle">পাসওয়ার্ড দিন</h2>
            <input type="password" id="passwordInput" class="w-full p-2 border rounded mb-4" placeholder="পাসওয়ার্ড" data-lang-key="passwordPlaceholder">
            <p id="passwordError" class="text-red-500 text-sm mb-4 hidden" data-lang-key="passwordError">ভুল পাসওয়ার্ড!</p>
            <button id="passwordSubmitBtn" class="btn btn-primary w-full" data-lang-key="submitBtn">জমা দিন</button>
            <button id="passwordCancelBtn" class="btn btn-secondary w-full mt-2" data-lang-key="cancelBtn">বাতিল করুন</button>
        </div>
    </div>

    <!-- পাসওয়ার্ড পরিবর্তন মোডাল -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content max-w-sm text-center">
            <span class="close-button" id="closeChangePasswordModal">&times;</span>
            <h2 class="text-xl font-bold mb-4 text-indigo-700" data-lang-key="changePasswordTitle">পাসওয়ার্ড পরিবর্তন করুন</h2>
            <label for="oldPasswordInput" class="block text-gray-700 font-semibold mb-1 text-left" data-lang-key="oldPasswordLabel">পুরাতন পাসওয়ার্ড:</label>
            <input type="password" id="oldPasswordInput" class="w-full p-2 border rounded mb-3" placeholder="পুরাতন পাসওয়ার্ড" data-lang-key="oldPasswordPlaceholder">
            <label for="newPasswordInput" class="block text-gray-700 font-semibold mb-1 text-left" data-lang-key="newPasswordLabel">নতুন পাসওয়ার্ড:</label>
            <input type="password" id="newPasswordInput" class="w-full p-2 border rounded mb-3" placeholder="নতুন পাসওয়ার্ড" data-lang-key="newPasswordPlaceholder">
            <label for="confirmNewPasswordInput" class="block text-gray-700 font-semibold mb-1 text-left" data-lang-key="confirmNewPasswordLabel">নতুন পাসওয়ার্ড নিশ্চিত করুন:</label>
            <input type="password" id="confirmNewPasswordInput" class="w-full p-2 border rounded mb-4" placeholder="নতুন পাসওয়ার্ড নিশ্চিত করুন" data-lang-key="confirmNewPasswordPlaceholder">
            <p id="changePasswordError" class="text-red-500 text-sm mb-4 hidden" data-lang-key="changePasswordError"></p>
            <button id="changePasswordSubmitBtn" class="btn btn-primary w-full" data-lang-key="updatePasswordBtn">আপডেট পাসওয়ার্ড</button>
            <button id="changePasswordCancelBtn" class="btn btn-secondary w-full mt-2" data-lang-key="cancelBtn">বাতিল করুন</button>
        </div>
    </div>

    <!-- সফল/ত্রুটি বার্তা মোডাল -->
    <div id="messageModal" class="modal">
        <div class="modal-content max-w-sm text-center">
            <h2 id="messageTitle" class="text-xl font-bold mb-4"></h2>
            <p id="messageText" class="mb-4"></p>
            <button id="messageCloseBtn" class="btn btn-primary w-full" data-lang-key="okBtn">ঠিক আছে</button>
        </div>
    </div>

    <!-- ইম্পোর্টের জন্য লুকানো ফাইল ইনপুট -->
    <input type="file" id="importFileInput" accept=".json" class="hidden">

    <!-- স্ক্রলিং টেক্সট ফুটার: পেজের নিচে স্বাগতম বার্তা এবং ডেভলপার তথ্য হোভারে দেখানোর জন্য -->
    <div class="scrolling-text-footer group">
        <div class="marquee text-lg font-semibold">
            স্বাগতম! জুয়েল এন্টারপ্রাইজে আপনাকে স্বাগতম! আপনার ব্যবসাকে সহজ করতে আমরা আপনার পাশে আছি।
        </div>
        <!-- হোভারে ডেভেলপার তথ্য -->
        <div id="developerInfoHover" class="developer-info-hover">
            <p class="text-base font-semibold text-indigo-700">নাম: SOHEL RANA</p>
            <p class="text-sm text-gray-700">পদবি: কম্পিউটার অপারেটর</p>
            <p class="text-sm text-gray-700">সংস্থা: জুয়েল এন্টারপ্রাইজ</p>
            <p class="text-sm text-gray-700">স্থান: ডিমলা, নীলফামারী</p>
        </div>
    </div>

    <!-- html2canvas এবং jsPDF লাইব্রেরি: মেমোকে PDF-এ রূপান্তর এবং ডাউনলোড করার জন্য -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // দোকানের বিবরণ (ভাষার উপর ভিত্তি করে পরিবর্তনশীল)
        const shopDetails = {
            bn: {
                name: "জুয়েল এন্টারপ্রাইজ",
                address: "বিসমিল্লা কমপ্লেক্স, ইনিয়ন পরিষদের সামনে, ডিমলা, নীলফামারী",
                mobile: "মোবাইল নং: 01711472098",
                email: "ইমেইল: jepdimla98@gmail.com"
            },
            en: {
                name: "JEWEL ENTERPRISE",
                address: "Bismilla Complex, Inion Parishad Front, Dimla, Nilphamari",
                mobile: "Mobile No: 01711472098",
                email: "Email: jepdimla98@gmail.com"
            }
        };

        // অনুবাদ অবজেক্ট: অ্যাপ্লিকেশনের সমস্ত টেক্সটের জন্য বাংলা এবং ইংরেজি অনুবাদ
        const translations = {
            bn: {
                languageToggleText: "বাংলা",
                memoNoLabel: "মেমো নং:",
                manualMemoNoToggle: "ম্যানুয়ালি পরিবর্তন করুন",
                dateLabel: "তারিখ:",
                customerNameLabel: "ক্রেতার নাম:",
                customerAddressLabel: "ঠিকানা:",
                customerMobileLabel: "মোবাইল নং:",
                slNoHeader: "ক্রমিক নং",
                descriptionHeader: "বিবরণ",
                quantityHeader: "পরিমাণ",
                rateHeader: "দাম",
                amountHeader: "টাকা",
                actionHeader: "অ্যাকশন",
                addProductBtn: "পণ্য যোগ করুন",
                subTotalLabel: "মোট টাকা (সাব-টোটাল):",
                discountLabel: "ডিসকাউন্ট (%):",
                grandTotalLabel: "সর্বমোট টাকা:",
                amountInWordsLabel: "কথায়:",
                paidAmountLabel: "পরিশোধিত টাকা:",
                dueAmountLabel: "বাকি টাকা:",
                buyerSignature: "ক্রেতার স্বাক্ষর",
                sellerSignature: "বিক্রেতার স্বাক্ষর",
                saveMemoBtn: "সংরক্ষণ করুন",
                printMemoBtn: "প্রিন্ট",
                downloadPdfBtn: "PDF ডাউনলোড",
                refreshMemoBtn: "রিসেট",
                homeBtn: "হোম",
                dashboardBtn: "ড্যাশবোর্ড",
                accountingBtn: "হিসাবরক্ষণ", // নতুন অনুবাদ
                historyBtn: "পূর্বের মেমো",
                salesReportBtn: "বিক্রয় রিপোর্ট",
                manageCustomersBtn: "কাস্টমার ম্যানেজ করুন",
                manageProductsBtn: "পণ্য ম্যানেজ করুন",
                importDataBtn: "ডেটা ইম্পোর্ট",
                exportDataBtn: "ডেটা এক্সপোর্ট",
                changePasswordBtn: "পাসওয়ার্ড পরিবর্তন করুন",
                developerInfoBtn: "ডেভলপার তথ্য",
                developerInfoTitle: "ডেভলপার তথ্য",
                historyTitle: "মেমো হিস্টোরি",
                historySearchPlaceholder: "মেমো নং বা ক্রেতার নাম দিয়ে খুঁজুন...",
                salesReportTitle: "বিক্রয় রিপোর্ট",
                startDateLabel: "শুরুর তারিখ:",
                endDateLabel: "শেষের তারিখ:",
                generateReportBtn: "রিপোর্ট তৈরি করুন",
                printReportBtn: "রিপোর্ট প্রিন্ট করুন",
                customerManagementTitle: "কাস্টমার ম্যানেজ করুন",
                saveCustomerBtn: "কাস্টমার সেভ করুন",
                productManagementTitle: "পণ্য ম্যানেজ করুন",
                stockLabel: "স্টক",
                saveProductBtn: "পণ্য সেভ করুন",
                passwordPromptTitle: "পাসওয়ার্ড দিন",
                passwordPlaceholder: "পাসওয়ার্ড",
                passwordError: "ভুল পাসওয়ার্ড!",
                submitBtn: "জমা দিন",
                cancelBtn: "বাতিল করুন",
                okBtn: "ঠিক আছে",
                memoSavedSuccess: "মেমো সফলভাবে সংরক্ষণ করা হয়েছে!",
                memoLoadedSuccess: "মেমো সফলভাবে লোড করা হয়েছে!",
                noHistoryFound: "কোনো মেমো হিস্টোরি পাওয়া যায়নি।",
                deleteProductConfirm: "আপনি কি নিশ্চিত এই পণ্যটি মুছে ফেলতে চান?",
                memoNoExists: "এই মেমো নম্বরটি ইতিমধ্যে বিদ্যমান। অনুগ্রহ করে অন্য একটি নম্বর দিন বা অটোমেটিক মোড ব্যবহার করুন।",
                changePasswordTitle: "পাসওয়ার্ড পরিবর্তন করুন",
                oldPasswordLabel: "পুরাতন পাসওয়ার্ড:",
                oldPasswordPlaceholder: "পুরাতন পাসওয়ার্ড",
                newPasswordLabel: "নতুন পাসওয়ার্ড:",
                newPasswordPlaceholder: "নতুন পাসওয়ার্ড",
                confirmNewPasswordLabel: "নতুন পাসওয়ার্ড নিশ্চিত করুন:",
                confirmNewPasswordPlaceholder: "নতুন পাসওয়ার্ড নিশ্চিত করুন",
                updatePasswordBtn: "আপডেট পাসওয়ার্ড",
                changePasswordError: "পাসওয়ার্ড পরিবর্তন ব্যর্থ হয়েছে।",
                passwordMismatch: "নতুন পাসওয়ার্ড এবং নিশ্চিতকরণ পাসওয়ার্ড মেলে না।",
                passwordChangedSuccess: "পাসওয়ার্ড সফলভাবে পরিবর্তন করা হয়েছে!",
                customerDeleteConfirm: "আপনি কি নিশ্চিত এই কাস্টমারকে মুছে ফেলতে চান?",
                productDeleteConfirm: "আপনি কি নিশ্চিত এই পণ্যটি মুছে ফেলতে চান?",
                customerAdded: "কাস্টমার সফলভাবে যোগ করা হয়েছে!",
                customerUpdated: "কাস্টমার সফলভাবে আপডেট করা হয়েছে!",
                productAdded: "পণ্য সফলভাবে যোগ করা হয়েছে!",
                productUpdated: "পণ্য সফলভাবে আপডেট করা হয়েছে!",
                quantityExceedsStock: "পরিমাণ স্টকের বেশি হতে পারে না। উপলব্ধ স্টক: ",
                dashboardTitle: "ড্যাশবোর্ড",
                totalMemos: "মোট মেমো:",
                totalCustomers: "মোট কাস্টমার:",
                totalProducts: "মোট পণ্য:",
                totalSalesAmount: "মোট বিক্রয়:",
                productStockTitle: "পণ্য স্টক",
                outOfStock: "(স্টক নেই)",
                importSuccess: "ডেটা সফলভাবে ইম্পোর্ট করা হয়েছে!",
                importError: "ডেটা ইম্পোর্ট ব্যর্থ হয়েছে। ফাইলটি সঠিক ফরম্যাটে নেই বা ক্ষতিগ্রস্ত।",
                exportSuccess: "ডেটা সফলভাবে এক্সপোর্ট করা হয়েছে!",
                exportError: "ডেটা এক্সপোর্ট ব্যর্থ হয়েছে।",
                productCodeLabel: "প্রোডাক্ট কোড:",
                currentStockLabel: "বর্তমান স্টক",
                stockHistoryTitle: "স্টক ইতিহাস",
                typeLabel: "ধরণ",
                purchaseRateLabel: "কেনা দাম:",
                sellingRateLabel: "বিক্রয় দাম:",
                imageUrlLabel: "ছবির URL (ঐচ্ছিক):",
                noImageAvailable: "ছবি নেই",
                // অ্যাকাউন্টিংয়ের জন্য নতুন অনুবাদ
                accountingTitle: "দৈনিক আয়-ব্যয়ের তথ্য",
                incomeLabel: "আয়:",
                expenseLabel: "ব্যয়:",
                expenseCategoryLabel: "ব্যয়ের খাত:",
                commentLabel: "মন্তব্য:",
                addEntryBtn: "এন্ট্রি যোগ করুন",
                accountingReportTitle: "আয়-ব্যয় রিপোর্ট",
                last7DaysBtn: "গত ৭ দিন",
                thisMonthBtn: "এই মাস",
                lastMonthBtn: "গত মাস",
                totalIncome: "মোট আয়:",
                totalExpense: "মোট ব্যয়:",
                netBalance: "নিট ব্যালেন্স:",
                noAccountingEntries: "কোনো আয়-ব্যয় এন্ট্রি পাওয়া যায়নি।",
                entryAddedSuccess: "এন্ট্রি সফলভাবে যোগ করা হয়েছে!",
                entryDeletedSuccess: "এন্ট্রি সফলভাবে মুছে ফেলা হয়েছে!",
                deleteEntryConfirm: "আপনি কি নিশ্চিত এই এন্ট্রিটি মুছে ফেলতে চান?",
                balance: "ব্যালেন্স:"
            },
            en: {
                languageToggleText: "বাংলা",
                memoNoLabel: "Memo No:",
                manualMemoNoToggle: "Change Manually",
                dateLabel: "Date:",
                customerNameLabel: "Customer Name:",
                customerAddressLabel: "Address:",
                customerMobileLabel: "Mobile No:",
                slNoHeader: "SL No",
                descriptionHeader: "Description",
                quantityHeader: "Quantity",
                rateHeader: "Rate",
                amountHeader: "Amount",
                actionHeader: "Action",
                addProductBtn: "Add Product",
                subTotalLabel: "Sub Total:",
                discountLabel: "Discount (%):",
                grandTotalLabel: "Grand Total:",
                amountInWordsLabel: "Amount in Words:",
                paidAmountLabel: "Paid Amount:",
                dueAmountLabel: "Due Amount:",
                buyerSignature: "Buyer's Signature",
                sellerSignature: "Seller's Signature",
                saveMemoBtn: "Save Memo",
                printMemoBtn: "Print",
                downloadPdfBtn: "Download PDF",
                refreshMemoBtn: "Reset",
                homeBtn: "Home",
                dashboardBtn: "Dashboard",
                accountingBtn: "Accounting", // নতুন অনুবাদ
                historyBtn: "Previous Memos",
                salesReportBtn: "Sales Report",
                manageCustomersBtn: "Manage Customers",
                manageProductsBtn: "Manage Products",
                importDataBtn: "Import Data",
                exportDataBtn: "Export Data",
                changePasswordBtn: "Change Password",
                developerInfoBtn: "Developer Info",
                developerInfoTitle: "Developer Information",
                historyTitle: "Memo History",
                historySearchPlaceholder: "Search by Memo No or Customer Name...",
                salesReportTitle: "Sales Report",
                startDateLabel: "Start Date:",
                endDateLabel: "End Date:",
                generateReportBtn: "Generate Report",
                printReportBtn: "Print Report",
                customerManagementTitle: "Manage Customers",
                saveCustomerBtn: "Save Customer",
                productManagementTitle: "Manage Products",
                stockLabel: "Stock",
                saveProductBtn: "Save Product",
                passwordPromptTitle: "Enter Password",
                passwordPlaceholder: "Password",
                passwordError: "Incorrect Password!",
                submitBtn: "Submit",
                cancelBtn: "Cancel",
                okBtn: "OK",
                memoSavedSuccess: "Memo saved successfully!",
                memoLoadedSuccess: "Memo loaded successfully!",
                noHistoryFound: "No memo history found.",
                deleteProductConfirm: "Are you sure you want to delete this product?",
                memoNoExists: "This memo number already exists. Please enter a different number or use auto mode.",
                changePasswordTitle: "Change Password",
                oldPasswordLabel: "Old Password:",
                oldPasswordPlaceholder: "Old Password",
                newPasswordLabel: "New Password:",
                newPasswordPlaceholder: "New Password",
                confirmNewPasswordLabel: "Confirm New Password:",
                confirmNewPasswordPlaceholder: "Confirm New Password",
                updatePasswordBtn: "Update Password",
                changePasswordError: "Password change failed.",
                passwordMismatch: "New password and confirm password do not match.",
                passwordChangedSuccess: "Password changed successfully!",
                customerDeleteConfirm: "Are you sure you want to delete this customer?",
                productDeleteConfirm: "Are you sure you want to delete this product?",
                customerAdded: "Customer added successfully!",
                customerUpdated: "Customer updated successfully!",
                productAdded: "Product added successfully!",
                productUpdated: "Product updated successfully!",
                quantityExceedsStock: "Quantity cannot exceed stock. Available stock: ",
                dashboardTitle: "Dashboard",
                totalMemos: "Total Memos:",
                totalCustomers: "Total Customers:",
                totalProducts: "Total Products:",
                totalSalesAmount: "Total Sales:",
                productStockTitle: "Product Stock",
                outOfStock: "(Out of Stock)",
                importSuccess: "Data imported successfully!",
                importError: "Data import failed. File is not in correct format or corrupted.",
                exportSuccess: "Data exported successfully!",
                exportError: "Data export failed.",
                productCodeLabel: "Product Code:",
                currentStockLabel: "Current Stock",
                stockHistoryTitle: "Stock History",
                typeLabel: "Type",
                purchaseRateLabel: "Purchase Price:",
                sellingRateLabel: "Selling Price:",
                imageUrlLabel: "Image URL (Optional):",
                noImageAvailable: "No Image Available",
                // New translations for accounting
                accountingTitle: "Daily Income & Expense",
                incomeLabel: "Income:",
                expenseLabel: "Expense:",
                expenseCategoryLabel: "Expense Category:",
                commentLabel: "Comment:",
                addEntryBtn: "Add Entry",
                accountingReportTitle: "Income & Expense Report",
                last7DaysBtn: "Last 7 Days",
                thisMonthBtn: "This Month",
                lastMonthBtn: "Last Month",
                totalIncome: "Total Income:",
                totalExpense: "Total Expense:",
                netBalance: "Net Balance:",
                noAccountingEntries: "No income/expense entries found.",
                entryAddedSuccess: "Entry added successfully!",
                entryDeletedSuccess: "Entry deleted successfully!",
                deleteEntryConfirm: "Are you sure you want to delete this entry?",
                balance: "Balance:"
            }
        };

        // গ্লোবাল ভেরিয়েবল: অ্যাপ্লিকেশনের বিভিন্ন ডেটা এবং স্টেট ট্র্যাক করার জন্য
        let currentLanguage = 'bn'; // বর্তমান ভাষা (ডিফল্ট: বাংলা)
        let lastMemoNumber = 0; // শেষ ব্যবহৃত মেমো নম্বর
        let memoHistory = []; // সমস্ত সংরক্ষিত মেমোর অ্যারে
        let customerDirectory = []; // গ্রাহকদের তালিকার অ্যারে
        let productDirectory = []; // প্রতিটি পণ্যের বর্তমান মোট স্টক সহ তালিকার অ্যারে
        let stockLog = []; // সমস্ত স্টক ইন/আউট লেনদেনের লগ
        let accountingEntries = []; // নতুন: আয়-ব্যয় এন্ট্রি সংরক্ষণের জন্য অ্যারে
        let HISTORY_PASSWORD = localStorage.getItem('historyPassword') || "5566"; // পাসওয়ার্ড (লোকাল স্টোরেজ থেকে লোড হয় বা ডিফল্ট)
        let isManualMemoNo = false; // মেমো নম্বর ম্যানুয়াল মোডে আছে কিনা তা নির্দেশ করে

        // DOM উপাদান: HTML উপাদানগুলিকে জাভাস্ক্রিপ্টে অ্যাক্সেস করার জন্য রেফারেন্স
        const mainContentWrapper = document.querySelector('.main-content-wrapper');

        const languageToggle = document.getElementById('languageToggle');
        const languageToggleText = document.getElementById('languageToggleText');
        const shopNameElem = document.getElementById('shopName');
        const shopAddressElem = document.getElementById('shopAddress');
        const shopMobileElem = document.getElementById('shopMobile');
        const shopEmailElem = document.getElementById('shopEmail');
        const memoNoInput = document.getElementById('memoNo');
        const manualMemoNoToggleBtn = document.getElementById('manualMemoNoToggle');
        const memoDateInput = document.getElementById('memoDate');
        const customerNameInput = document.getElementById('customerName');
        const customerAddressInput = document.getElementById('customerAddress');
        const customerMobileInput = document.getElementById('customerMobile');
        const customerNamesDatalist = document.getElementById('customerNames');
        const productTableBody = document.getElementById('productTableBody');
        const addProductBtn = document.getElementById('addProductBtn');
        const subTotalInput = document.getElementById('subTotal');
        const discountInput = document.getElementById('discount');
        const grandTotalInput = document.getElementById('grandTotal');
        const amountInWordsTextarea = document.getElementById('amountInWords');
        const paidAmountInput = document.getElementById('paidAmount');
        const dueAmountInput = document.getElementById('dueAmount');
        const saveMemoBtn = document.getElementById('saveMemoBtn'); // সাইডবার সেভ বাটন
        const printMemoBtn = document.getElementById('printMemoBtn'); // সাইডবার প্রিন্ট বাটন
        const downloadPdfBtn = document.getElementById('downloadPdfBtn'); // সাইডবার ডাউনলোড PDF বাটন (HTML থেকে সরানো হয়েছে, কিন্তু রেফারেন্সের জন্য রাখা হয়েছে)
        const refreshMemoBtn = document.getElementById('refreshMemoBtn'); // সাইডবার রিফ্রেশ বাটন (UI তে 'রিসেট' হিসাবে নামকরণ করা হয়েছে)
        const homeBtn = document.getElementById('homeBtn');
        const dashboardBtnMain = document.getElementById('dashboardBtnMain'); // সাইডবারে ড্যাশবোর্ড বাটন
        const accountingBtn = document.getElementById('accountingBtn'); // নতুন: অ্যাকাউন্টিং বাটন
        const historyBtn = document.getElementById('historyBtn');
        const salesReportBtn = document.getElementById('salesReportBtn');
        const manageCustomersBtn = document.getElementById('manageCustomersBtn');
        const manageProductsBtn = document.getElementById('manageProductsBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const developerInfoBtn = document.getElementById('developerInfoBtn');

        // মেমোর নিচের অংশে নতুন বাটনগুলি
        const saveMemoBottomBtn = document.getElementById('saveMemoBottomBtn');
        const printMemoBottomBtn = document.getElementById('printMemoBottomBtn');
        const resetMemoBottomBtn = document.getElementById('resetMemoBottomBtn');

        // মোডাল এবং তাদের উপাদান
        const dashboardModal = document.getElementById('dashboardModal');
        const closeDashboardModal = document.getElementById('closeDashboardModal');
        const dashboardProductStockTableBody = document.getElementById('dashboardProductStockTableBody');

        const historyModal = document.getElementById('historyModal');
        const closeHistoryModal = document.getElementById('closeHistoryModal');
        const historySearchInput = document.getElementById('historySearchInput');
        const historyList = document.getElementById('historyList');

        const salesReportModal = document.getElementById('salesReportModal');
        const closeSalesReportModal = document.getElementById('closeSalesReportModal');
        const reportStartDateInput = document.getElementById('reportStartDate');
        const reportEndDateInput = document.getElementById('reportEndDate');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const printReportBtn = document.getElementById('printReportBtn');
        const reportContentDiv = document.getElementById('reportContent');

        const customerManagementModal = document.getElementById('customerManagementModal');
        const closeCustomerManagementModal = document.getElementById('closeCustomerManagementModal');
        const customerForm = document.getElementById('customerForm');
        const customerIdInput = document.getElementById('customerId');
        const customerMgtNameInput = document.getElementById('customerMgtName');
        const customerMgtAddressInput = document.getElementById('customerMgtAddress');
        const customerMgtMobileInput = document.getElementById('customerMgtMobile');
        const customerTableBody = document.getElementById('customerTableBody');

        const productManagementModal = document.getElementById('productManagementModal');
        const closeProductManagementModal = document.getElementById('closeProductManagementModal');
        const productForm = document.getElementById('productForm');
        const productIdInput = document.getElementById('productId');
        const productMgtCodeInput = document.getElementById('productMgtCode');
        const productMgtDescriptionInput = document.getElementById('productMgtDescription');
        const productMgtPurchaseRateInput = document.getElementById('productMgtPurchaseRate');
        const productMgtRateInput = document.getElementById('productMgtRate'); // এটি এখন বিক্রয় মূল্য
        const productMgtStockInput = document.getElementById('productMgtStock');
        const productMgtImageUrlInput = document.getElementById('productMgtImageUrl');
        const productTableBodyMgt = document.getElementById('productTableBodyMgt');

        const stockHistoryModal = document.getElementById('stockHistoryModal');
        const closeStockHistoryModal = document.getElementById('closeStockHistoryModal');
        const stockHistoryProductName = document.getElementById('stockHistoryProductName');
        const stockHistoryTableBody = document.getElementById('stockHistoryTableBody');

        const developerInfoModal = document.getElementById('developerInfoModal');
        const closeDeveloperInfoModal = document.getElementById('closeDeveloperInfoModal');
        const developerInfoHover = document.getElementById('developerInfoHover'); // হোভার ইফেক্টের জন্য নতুন

        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const passwordError = document.getElementById('passwordError');
        const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
        const passwordCancelBtn = document.getElementById('passwordCancelBtn');

        const changePasswordModal = document.getElementById('changePasswordModal');
        const closeChangePasswordModal = document.getElementById('closeChangePasswordModal');
        const oldPasswordInput = document.getElementById('oldPasswordInput');
        const newPasswordInput = document.getElementById('newPasswordInput');
        const confirmNewPasswordInput = document.getElementById('confirmNewPasswordInput');
        const changePasswordError = document.getElementById('changePasswordError');
        const changePasswordSubmitBtn = document.getElementById('changePasswordSubmitBtn');
        const changePasswordCancelBtn = document.getElementById('changePasswordCancelBtn');

        const messageModal = document.getElementById('messageModal');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageCloseBtn = document.getElementById('messageCloseBtn');

        // ড্যাশবোর্ডের উপাদান
        const totalMemosValue = document.getElementById('totalMemosValue');
        const totalCustomersValue = document.getElementById('totalCustomersValue');
        const totalProductsValue = document.getElementById('totalProductsValue');
        const totalSalesAmountValue = document.getElementById('totalSalesAmountValue');

        // ড্যাশবোর্ডের দ্রুত লিঙ্কগুলি
        const dashboardHistoryBtn = document.getElementById('dashboardHistoryBtn');
        const dashboardSalesReportBtn = document.getElementById('dashboardSalesReportBtn');
        const dashboardManageCustomersBtn = document.getElementById('dashboardManageCustomersBtn');
        const dashboardManageProductsBtn = document.getElementById('dashboardManageProductsBtn');
        const dashboardImportDataBtn = document.getElementById('dashboardImportDataBtn');
        const dashboardExportDataBtn = document.getElementById('dashboardExportDataBtn');

        // ইম্পোর্টের জন্য লুকানো ফাইল ইনপুট
        const importFileInput = document.getElementById('importFileInput');

        // নতুন অ্যাকাউন্টিং মোডালের উপাদান
        const accountingModal = document.getElementById('accountingModal');
        const closeAccountingModal = document.getElementById('closeAccountingModal');
        const accountingForm = document.getElementById('accountingForm');
        const accountingSlNoInput = document.getElementById('accountingSlNo');
        const accountingDateInput = document.getElementById('accountingDate');
        const accountingIncomeInput = document.getElementById('accountingIncome');
        const accountingExpenseInput = document.getElementById('accountingExpense');
        const accountingExpenseCategoryInput = document.getElementById('accountingExpenseCategory');
        const accountingCommentInput = document.getElementById('accountingComment');
        const accountingReportStartDateInput = document.getElementById('accountingReportStartDate');
        const accountingReportEndDateInput = document.getElementById('accountingReportEndDate');
        const accountingReport7DaysBtn = document.getElementById('accountingReport7DaysBtn');
        const accountingReportThisMonthBtn = document.getElementById('accountingReportThisMonthBtn');
        const accountingReportLastMonthBtn = document.getElementById('accountingReportLastMonthBtn');
        const generateAccountingReportBtn = document.getElementById('generateAccountingReportBtn');
        const accountingReportContent = document.getElementById('accountingReportContent');
        const printAccountingReportBtn = document.getElementById('printAccountingReportBtn');


        /**
         * ইউটিলিটি ফাংশনসমূহ
         */

        /**
         * ব্যবহারকারীকে একটি মোডাল বার্তা প্রদর্শন করে।
         * @param {string} title - বার্তার শিরোনাম।
         * @param {string} text - বার্তার মূল টেক্সট কন্টেন্ট।
         * @param {string} [type='info'] - বার্তার ধরন ('info', 'success', 'error')।
         */
        function showMessage(title, text, type = 'info') {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageTitle.className = `text-xl font-bold mb-4 ${type === 'error' ? 'text-red-700' : 'text-indigo-700'}`;
            messageModal.style.display = 'flex';
        }

        /**
         * মোডাল বার্তা লুকায়।
         */
        function hideMessage() {
            messageModal.style.display = 'none';
        }

        /**
         * তার data-lang-key অ্যাট্রিবিউটের উপর ভিত্তি করে একটি একক DOM উপাদান অনুবাদ করে।
         * @param {HTMLElement} element - অনুবাদ করার জন্য DOM উপাদান।
         * @param {string} langKey - অনুবাদ অবজেক্টে অনুবাদের জন্য কী।
         */
        function translateElement(element, langKey) {
            if (element && translations[currentLanguage][langKey]) {
                element.textContent = translations[currentLanguage][langKey];
            }
        }

        /**
         * `data-lang-key` অ্যাট্রিবিউট সহ সমস্ত উপাদানগুলিতে অনুবাদ প্রয়োগ করে।
         */
        function applyTranslations() {
            // ভাষা টগল বাটনের টেক্সট আপডেট করুন
            languageToggleText.textContent = translations[currentLanguage].languageToggleText;

            // দোকানের বিবরণ আপডেট করুন
            shopNameElem.textContent = shopDetails[currentLanguage].name;
            shopAddressElem.textContent = shopDetails[currentLanguage].address;
            shopMobileElem.textContent = shopDetails[currentLanguage].mobile;
            shopEmailElem.textContent = shopDetails[currentLanguage].email;

            // data-lang-key অ্যাট্রিবিউট সহ উপাদানগুলি আপডেট করুন
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const langKey = element.getAttribute('data-lang-key');
                if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                    element.placeholder = translations[currentLanguage][langKey] || element.placeholder;
                } else {
                    element.textContent = translations[currentLanguage][langKey] || element.textContent;
                }
            });

            // কথায় পরিমাণ পুনরায় গণনা করুন
            updateTotals();
            updateDashboard(); // ভাষা পরিবর্তনের পরে ড্যাশবোর্ডের কন্টেন্ট আপডেট করুন
            // অ্যাকাউন্টিং রিপোর্ট পুনরায় তৈরি করুন যদি খোলা থাকে
            if (accountingModal.style.display === 'flex') {
                generateAccountingReport();
            }
        }

        /**
         * অ্যাপ্লিকেশন ভাষা বাংলা এবং ইংরেজির মধ্যে টগল করে।
         */
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'bn' ? 'en' : 'bn';
            document.documentElement.lang = currentLanguage; // HTML lang অ্যাট্রিবিউট সেট করুন
            applyTranslations();
        }

        /**
         * একটি নতুন ক্রমিক মেমো নম্বর তৈরি করে এবং মেমো নম্বর ইনপুটে সেট করে।
         */
        function generateMemoNumber() {
            lastMemoNumber = parseInt(localStorage.getItem('lastMemoNumber') || '0');
            const newMemoNo = String(lastMemoNumber + 1).padStart(5, '0');
            memoNoInput.value = newMemoNo;
            memoNoInput.readOnly = true; // অটো মোড ডিফল্ট
            isManualMemoNo = false;
            manualMemoNoToggleBtn.textContent = translations[currentLanguage].manualMemoNoToggle;
        }

        /**
         * স্বয়ংক্রিয় এবং ম্যানুয়াল মেমো নম্বর ইনপুটের মধ্যে টগল করে।
         */
        function toggleManualMemoNo() {
            isManualMemoNo = !isManualMemoNo;
            memoNoInput.readOnly = !isManualMemoNo;
            manualMemoNoToggleBtn.textContent = isManualMemoNo ?
                (currentLanguage === 'bn' ? "অটোমেটিক করুন" : "Set Auto") :
                translations[currentLanguage].manualMemoNoToggle;
            if (!isManualMemoNo) {
                generateMemoNumber(); // টগল বন্ধ হলে অটোতে ফিরে যান
            }
        }

        /**
         * আজকের তারিখ YYYY-MM-DD ফরম্যাটে ফেরত দেয়।
         * @returns {string} ফরম্যাট করা তারিখ স্ট্রিং।
         */
        function getTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // মাস 0 থেকে শুরু হয়!
            const dd = String(today.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        /**
         * বর্তমান ভাষার উপর ভিত্তি করে একটি সংখ্যাকে কথায় রূপান্তর করে।
         * @param {number} num - রূপান্তর করার জন্য সংখ্যা।
         * @param {string} lang - ভাষা ('bn' বাংলার জন্য, 'en' ইংরেজির জন্য)।
         * @returns {string} সংখ্যাটি কথায়।
         */
        function numberToWords(num, lang) {
            if (num === 0) return lang === 'bn' ? 'শূন্য টাকা মাত্র' : 'Zero Taka Only';

            const unitsBn = ['', 'এক', 'দুই', 'তিন', 'চার', 'পাঁচ', 'ছয়', 'সাত', 'আট', 'নয়'];
            const teensBn = ['দশ', 'এগারো', 'বারো', 'তেরো', 'চৌদ্দ', 'পনেরো', 'ষোল', 'সতেরো', 'আঠারো', 'উনিশ'];
            const tensBn = ['', '', 'বিশ', 'ত্রিশ', 'চল্লিশ', 'পঞ্চাশ', 'ষাট', 'সত্তর', 'আশি', 'নব্বই'];
            const scalesBn = [
                { value: 10000000, label: 'কোটি' },
                { value: 100000, label: 'লাখ' },
                { value: 1000, label: 'হাজার' },
                { value: 100, label: 'শত' }
            ];

            const unitsEn = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const teensEn = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tensEn = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const scalesEn = [
                { value: 1000000000, label: 'Billion' },
                { value: 1000000, label: 'Million' },
                { value: 1000, label: 'Thousand' },
                { value: 100, label: 'Hundred' }
            ];

            const convertLessThanOneThousand = (n, currentUnits, currentTeens, currentTens) => {
                let s = '';
                if (n >= 100) {
                    s += currentUnits[Math.floor(n / 100)] + ' ' + (lang === 'bn' ? 'শত' : 'Hundred') + ' ';
                    n %= 100;
                }
                if (n >= 20) {
                    s += currentTens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                }
                if (n >= 10) {
                    s += currentTeens[n - 10] + ' ';
                    n = 0;
                }
                if (n > 0) {
                    s += currentUnits[n] + ' ';
                }
                return s.trim();
            };

            let words = [];
            let currentNum = Math.floor(num);

            if (lang === 'bn') {
                if (currentNum === 0) return 'শূন্য টাকা মাত্র';

                for (let i = 0; i < scalesBn.length; i++) {
                    const scale = scalesBn[i];
                    if (currentNum >= scale.value) {
                        const chunk = Math.floor(currentNum / scale.value);
                        words.push(convertLessThanOneThousand(chunk, unitsBn, teensBn, tensBn) + ' ' + scale.label);
                        currentNum %= scale.value;
                    }
                }
                if (currentNum > 0) {
                    words.push(convertLessThanOneThousand(currentNum, unitsBn, teensBn, tensBn));
                }
                return words.join(' ').trim() + ' টাকা মাত্র';

            } else { // English
                if (currentNum === 0) return 'Zero Taka Only';

                for (let i = 0; i < scalesEn.length; i++) {
                    const scale = scalesEn[i];
                    if (currentNum >= scale.value) {
                        const chunk = Math.floor(currentNum / scale.value);
                        words.push(convertLessThanOneThousand(chunk, unitsEn, teensEn, tensEn) + ' ' + scale.label);
                        currentNum %= scale.value;
                    }
                }
                if (currentNum > 0) {
                    words.push(convertLessThanOneThousand(currentNum, unitsEn, teensEn, tensEn));
                }
                return words.join(' ').trim() + ' Taka Only';
            }
        }

        /**
         * কোর মেমো লজিক ফাংশনসমূহ
         */

        /**
         * মেমো টেবিলে একটি নতুন পণ্যের সারি যোগ করে।
         * @param {Object} [product={}] - সারি পূরণ করার জন্য ঐচ্ছিক পণ্যের অবজেক্ট।
         */
        function addTableRow(product = {}) {
            const rowCount = productTableBody.rows.length;
            const newRow = productTableBody.insertRow();
            newRow.className = 'border-b border-gray-200';
            newRow.setAttribute('data-row-id', Date.now() + rowCount);

            const slNoCell = newRow.insertCell();
            slNoCell.className = 'py-1.5 px-2 text-center text-sm';
            slNoCell.textContent = rowCount + 1;

            const descriptionCell = newRow.insertCell();
            descriptionCell.className = 'py-1.5 px-2';
            // বিবরণ এবং পণ্য কোডের জন্য একটি সম্মিলিত ডেটালিস্ট ব্যবহার করুন
            descriptionCell.innerHTML = `<input type="text" class="description w-full text-sm py-1 px-2" value="${product.description || ''}" list="productDescriptionsAndCodes" placeholder="${translations[currentLanguage].descriptionHeader} / ${translations[currentLanguage].productCodeLabel}">`;
            let productDescriptionsAndCodesDatalist = document.getElementById('productDescriptionsAndCodes');
            if (!productDescriptionsAndCodesDatalist) {
                productDescriptionsAndCodesDatalist = document.createElement('datalist');
                productDescriptionsAndCodesDatalist.id = 'productDescriptionsAndCodes';
                document.body.appendChild(productDescriptionsAndCodesDatalist);
            }

            const quantityCell = newRow.insertCell();
            quantityCell.className = 'py-1.5 px-2';
            quantityCell.innerHTML = `<input type="number" class="quantity w-20 text-sm py-1 px-2" value="${product.quantity || 1}" min="0">`;

            const rateCell = newRow.insertCell();
            rateCell.className = 'py-1.5 px-2';
            rateCell.innerHTML = `<input type="number" class="rate w-24 text-sm py-1 px-2" value="${product.rate || 0}" min="0" step="0.01">`;

            const amountCell = newRow.insertCell();
            amountCell.className = 'py-1.5 px-2 text-right font-semibold';
            amountCell.innerHTML = `<input type="text" class="amount w-28 bg-gray-50 text-sm py-1 px-2" value="${(product.amount || 0).toFixed(2)}" readonly>`;

            const actionCell = newRow.insertCell();
            actionCell.className = 'py-1.5 px-2 text-center print-hidden';
            actionCell.innerHTML = `<button class="delete-row-btn btn-danger text-white p-1.5 rounded-full text-xs"><i class="fas fa-trash"></i></button>`;

            // নতুন সারির জন্য ইভেন্ট লিসেনার
            const descriptionInput = newRow.querySelector('.description');
            const quantityInput = newRow.querySelector('.quantity');
            const rateInput = newRow.querySelector('.rate');
            const amountInput = newRow.querySelector('.amount');
            const deleteButton = newRow.querySelector('.delete-row-btn');

            const calculateRowAmount = () => {
                const qty = parseFloat(quantityInput.value) || 0;
                const rate = parseFloat(rateInput.value) || 0;
                const amount = qty * rate;
                amountInput.value = amount.toFixed(2);
                updateTotals();
            };

            // পণ্যের বিবরণ/কোড নির্বাচন করা হলে দাম স্বয়ংক্রিয়ভাবে পূরণ এবং স্টক পরীক্ষা করুন
            descriptionInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                const selectedProduct = productDirectory.find(p => p.description === searchTerm || p.code === searchTerm);
                if (selectedProduct) {
                    descriptionInput.value = selectedProduct.description; // কোড ব্যবহার করা হলে বিবরণ সেট করা নিশ্চিত করুন
                    rateInput.value = selectedProduct.sellingRate; // বিক্রয় মূল্য ব্যবহার করুন
                    // পণ্য নির্বাচন করা হলে স্টক পরীক্ষা করুন
                    if (selectedProduct.currentStock <= 0) {
                        showMessage("স্টক সতর্কতা", `${selectedProduct.description} ${translations[currentLanguage].outOfStock}`, 'error');
                        quantityInput.value = 0; // স্টক না থাকলে পরিমাণ 0 সেট করুন
                    } else if (parseFloat(quantityInput.value) === 0) {
                        quantityInput.value = 1; // স্টক উপলব্ধ থাকলে এবং পরিমাণ 0 হলে ডিফল্ট 1 সেট করুন
                    }
                    calculateRowAmount();
                }
            });

            // পরিমাণ ইনপুটে স্টক বৈধতা
            quantityInput.addEventListener('input', (e) => {
                const currentQuantity = parseFloat(e.target.value) || 0;
                const description = descriptionInput.value;
                const productInDir = productDirectory.find(p => p.description === description);

                if (productInDir) {
                    if (currentQuantity > productInDir.currentStock) {
                        showMessage("স্টক সতর্কতা", `${translations[currentLanguage].quantityExceedsStock} ${productInDir.currentStock}`, 'error');
                        e.target.value = productInDir.currentStock; // পরিমাণকে সর্বোচ্চ উপলব্ধ স্টকে সেট করুন
                    }
                }
                calculateRowAmount();
            });

            rateInput.addEventListener('input', calculateRowAmount);
            deleteButton.addEventListener('click', (e) => {
                if (confirm(translations[currentLanguage].deleteProductConfirm)) {
                    newRow.remove();
                    updateSlNos();
                    updateTotals();
                }
            });

            calculateRowAmount(); // নতুন সারির জন্য প্রাথমিক পরিমাণ গণনা করুন
        }

        /**
         * পণ্যের টেবিলে ক্রমিক নম্বর আপডেট করে।
         */
        function updateSlNos() {
            const rows = productTableBody.rows;
            for (let i = 0; i < rows.length; i++) {
                rows[i].cells[0].textContent = i + 1;
            }
        }

        /**
         * সাব-টোটাল, ডিসকাউন্ট, গ্র্যান্ড টোটাল এবং কথায় পরিমাণ গণনা ও আপডেট করে।
         */
        function updateTotals() {
            let subTotal = 0; // ডিসকাউন্টের আগে সমস্ত পণ্যের পরিমাণের যোগফল
            document.querySelectorAll('.amount').forEach(input => {
                subTotal += parseFloat(input.value) || 0;
            });

            const discountPercentage = parseFloat(discountInput.value) || 0;
            const discountAmount = subTotal * (discountPercentage / 100);
            const grandTotal = subTotal - discountAmount;

            subTotalInput.value = subTotal.toFixed(2); // পণ্যের পরিমাণের যোগফল প্রদর্শন করুন
            grandTotalInput.value = grandTotal.toFixed(2); // ডিসকাউন্টের পরে মোট প্রদর্শন করুন

            // বাকি টাকা গণনা করুন
            const paidAmount = parseFloat(paidAmountInput.value) || 0;
            const dueAmount = grandTotal - paidAmount;
            dueAmountInput.value = dueAmount.toFixed(2);

            amountInWordsTextarea.value = numberToWords(grandTotal, currentLanguage);
        }

        /**
         * বর্তমান মেমো ডেটা লোকাল স্টোরেজে সংরক্ষণ করে।
         */
        function saveMemo() {
            const memoNo = memoNoInput.value;
            const existingMemo = memoHistory.find(memo => memo.memoNo === memoNo);
            if (existingMemo && !isManualMemoNo) {
                showMessage(translations[currentLanguage].memoNoExists, translations[currentLanguage].memoNoExists, 'error');
                return;
            }

            const products = [];
            let stockUpdateNeeded = false;
            const memoDate = memoDateInput.value;

            productTableBody.querySelectorAll('tr').forEach(row => {
                const description = row.querySelector('.description').value;
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const rate = parseFloat(row.querySelector('.rate').value) || 0; // এটি মেমো থেকে বিক্রয় মূল্য
                const amount = parseFloat(row.querySelector('.amount').value) || 0;

                products.push({
                    slNo: parseInt(row.cells[0].textContent),
                    description: description,
                    quantity: quantity,
                    rate: rate, // বিক্রয় মূল্য সংরক্ষণ করুন
                    amount: amount
                });

                // পণ্য ডিরেক্টরি আপডেট করুন - স্টক কমানো এবং স্টক আউট লগ করুন
                const productInDir = productDirectory.find(p => p.description === description);
                if (productInDir) {
                    // এটি একটি নতুন মেমো হলে বা বিদ্যমান মেমোতে পরিমাণ পরিবর্তিত হলে কেবল স্টক কমানো হবে
                    const previousQuantity = existingMemo ? existingMemo.products.find(p => p.description === description)?.quantity || 0 : 0;
                    const quantityChange = quantity - previousQuantity;

                    if (quantityChange !== 0) {
                        productInDir.currentStock -= quantityChange;
                        if (productInDir.currentStock < 0) productInDir.currentStock = 0; // নেতিবাচক স্টক প্রতিরোধ করুন
                        stockUpdateNeeded = true;

                        // স্টক আউট লগ করুন
                        stockLog.push({
                            productId: productInDir.id,
                            date: memoDate,
                            type: 'out',
                            quantity: quantityChange,
                            memoNo: memoNo
                        });
                    }
                } else {
                    // পণ্য ডিরেক্টরিতে না থাকলে, 0 স্টক সহ যোগ করুন এবং স্টক আউট লগ করুন
                    if (description && rate > 0) {
                        const newProductId = Date.now().toString(); // সহজ আইডি তৈরি
                        productDirectory.push({ id: newProductId, code: '', description: description, purchaseRate: 0, sellingRate: rate, currentStock: 0, imageUrl: '' }); // নতুন পণ্যগুলি ব্যবস্থাপনা ছাড়া 0 স্টক দিয়ে শুরু হয়
                        stockLog.push({
                            productId: newProductId,
                            date: memoDate,
                            type: 'out',
                            quantity: quantity,
                            memoNo: memoNo
                        });
                        stockUpdateNeeded = true;
                    }
                }
            });

            if (stockUpdateNeeded) {
                saveProductDirectory();
                saveStockLog();
            }

            const customerName = customerNameInput.value;
            const customerAddress = customerAddressInput.value;
            const customerMobile = customerMobileInput.value;

            // গ্রাহক ডিরেক্টরি আপডেট করুন
            if (customerName) {
                updateCustomerDirectory({
                    name: customerName,
                    address: customerAddress,
                    mobile: customerMobile
                });
            }

            const memoData = {
                memoNo: memoNo,
                date: memoDate,
                customerName: customerName,
                customerAddress: customerAddress,
                customerMobile: customerMobile,
                products: products,
                subTotal: parseFloat(subTotalInput.value) || 0,
                discount: parseFloat(discountInput.value) || 0,
                grandTotal: parseFloat(grandTotalInput.value) || 0,
                amountInWords: amountInWordsTextarea.value,
                paidAmount: parseFloat(paidAmountInput.value) || 0,
                dueAmount: parseFloat(dueAmountInput.value) || 0,
                timestamp: new Date().toISOString()
            };

            if (existingMemo) {
                const index = memoHistory.findIndex(memo => memo.memoNo === memoNo);
                memoHistory[index] = memoData;
            } else {
                memoHistory.push(memoData);
                if (!isManualMemoNo) {
                    lastMemoNumber++;
                    localStorage.setItem('lastMemoNumber', lastMemoNumber);
                }
            }

            localStorage.setItem('memoHistory', JSON.stringify(memoHistory));
            showMessage(translations[currentLanguage].memoSavedSuccess, translations[currentLanguage].memoSavedSuccess, 'success');
            refreshMemo();
            updateDashboard();
        }

        /**
         * বর্তমান মেমো প্রিন্ট করে।
         */
        function printMemo() {
            window.print();
        }

        /**
         * বর্তমান মেমোকে PDF হিসাবে ডাউনলোড করে।
         */
        async function downloadPdf() {
            const memoContainer = document.querySelector('.memo-container');
            const originalPadding = memoContainer.style.padding;
            const originalMarginBottom = memoContainer.style.marginBottom;

            memoContainer.style.padding = '10mm'; // PDF তৈরির জন্য প্রিন্ট-নির্দিষ্ট প্যাডিং সেট করুন
            memoContainer.style.marginBottom = '0';

            // প্রিন্টের জন্য নয় এমন UI উপাদান লুকান
            document.querySelectorAll('.buttons-sidebar, .language-toggle, .modal, .dashboard-panel, .print-hidden, .signature-controls, .memo-bottom-buttons, .dashboard-button-main, .scrolling-text-footer, #developerInfoHover').forEach(el => el.classList.add('hidden'));

            const canvas = await html2canvas(memoContainer, {
                scale: 2,
                useCORS: true,
                ignoreElements: (element) => {
                    return element.classList.contains('print-hidden') || element.classList.contains('memo-bottom-buttons') || element.classList.contains('dashboard-button-main') || element.classList.contains('scrolling-text-footer') || element.id === 'developerInfoHover';
                }
            });

            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            pdf.save(`Cash_Memo_${memoNoInput.value}.pdf`);

            // UI উপাদান এবং আসল স্টাইল পুনরুদ্ধার করুন
            memoContainer.style.padding = originalPadding;
            memoContainer.style.marginBottom = originalMarginBottom;
            document.querySelectorAll('.buttons-sidebar, .language-toggle, .modal, .dashboard-panel, .print-hidden, .signature-controls, .memo-bottom-buttons, .dashboard-button-main, .scrolling-text-footer, #developerInfoHover').forEach(el => el.classList.remove('hidden'));
        }

        /**
         * মেমো ফর্মকে তার প্রাথমিক অবস্থায় রিসেট করে।
         */
        function refreshMemo() {
            generateMemoNumber();
            memoDateInput.value = getTodayDate();
            customerNameInput.value = '';
            customerAddressInput.value = '';
            customerMobileInput.value = '';
            productTableBody.innerHTML = '';
            addProductBtn.click(); // একটি প্রাথমিক খালি সারি যোগ করুন
            discountInput.value = '0';
            paidAmountInput.value = '0';
            updateTotals();
            updateDashboard();
        }

        /**
         * সংবেদনশীল কার্যক্রমে এগিয়ে যাওয়ার আগে ব্যবহারকারীর কাছ থেকে পাসওয়ার্ড চায়।
         * @param {Function} callback - পাসওয়ার্ড সঠিক হলে এক্সিকিউট করার জন্য ফাংশন।
         */
        function showPasswordPrompt(callback) {
            passwordInput.value = '';
            passwordError.classList.add('hidden');
            passwordModal.style.display = 'flex';

            const handleSubmit = () => {
                if (passwordInput.value === HISTORY_PASSWORD) {
                    passwordModal.style.display = 'none';
                    callback();
                } else {
                    passwordError.textContent = translations[currentLanguage].passwordError;
                    passwordError.classList.remove('hidden');
                }
            };

            if (passwordSubmitBtn) passwordSubmitBtn.onclick = handleSubmit;
            if (passwordInput) passwordInput.onkeyup = (event) => {
                if (event.key === 'Enter') {
                    handleSubmit();
                }
            };
            if (passwordCancelBtn) passwordCancelBtn.onclick = () => {
                passwordModal.style.display = 'none';
            };
        }

        /**
         * মেমো হিস্টোরি লোড করে এবং একটি মোডালে প্রদর্শন করে।
         */
        function showHistory() {
            showPasswordPrompt(() => {
                historyModal.style.display = 'flex';
                loadHistoryList();
            });
        }

        /**
         * মোডালে হিস্টোরি তালিকা পূরণ করে, ঐচ্ছিকভাবে একটি সার্চ টার্ম দ্বারা ফিল্টার করে।
         * @param {string} [searchTerm=''] - মেমো নম্বর বা গ্রাহকের নামে সার্চ করার জন্য টার্ম।
         */
        function loadHistoryList(searchTerm = '') {
            historyList.innerHTML = '';
            const filteredHistory = memoHistory.filter(memo =>
                memo.memoNo.includes(searchTerm) ||
                memo.customerName.toLowerCase().includes(searchTerm.toLowerCase())
            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            if (filteredHistory.length === 0) {
                historyList.innerHTML = `<p class="text-gray-500 p-4">${translations[currentLanguage].noHistoryFound}</p>`;
                return;
            }

            filteredHistory.forEach(memo => {
                const memoItem = document.createElement('div');
                memoItem.className = 'border border-gray-300 rounded-lg p-3 mb-2 cursor-pointer hover:bg-gray-50 transition-colors';
                memoItem.innerHTML = `
                    <p class="font-bold text-indigo-600">${translations[currentLanguage].memoNoLabel} ${memo.memoNo}</p>
                    <p class="text-sm text-gray-700">${translations[currentLanguage].dateLabel} ${memo.date}</p>
                    <p class="text-sm text-gray-700">${translations[currentLanguage].customerNameLabel} ${memo.customerName}</p>
                    <p class="text-sm text-gray-700">${translations[currentLanguage].grandTotalLabel} ${memo.grandTotal.toFixed(2)}</p>
                    <p class="text-sm text-gray-700">${memo.dueAmount > 0 ? `${translations[currentLanguage].dueAmountLabel} ${memo.dueAmount.toFixed(2)}` : ''}</p>
                `;
                memoItem.addEventListener('click', () => {
                    loadMemoFromHistory(memo.memoNo);
                    historyModal.style.display = 'none';
                    showMessage(translations[currentLanguage].memoLoadedSuccess, translations[currentLanguage].memoLoadedSuccess, 'success');
                });
                historyList.appendChild(memoItem);
            });
        }

        /**
         * হিস্টোরি থেকে একটি নির্দিষ্ট মেমো মূল মেমো ফর্মে লোড করে।
         * @param {string} memoNo - লোড করার জন্য মেমো নম্বর।
         */
        function loadMemoFromHistory(memoNo) {
            const memo = memoHistory.find(m => m.memoNo === memoNo);
            if (memo) {
                memoNoInput.value = memo.memoNo;
                memoNoInput.readOnly = true;
                isManualMemoNo = true;
                manualMemoNoToggleBtn.textContent = currentLanguage === 'bn' ? "অটোমেটিক করুন" : "Set Auto";

                memoDateInput.value = memo.date;
                customerNameInput.value = memo.customerName;
                customerAddressInput.value = memo.customerAddress;
                customerMobileInput.value = memo.customerMobile;
                discountInput.value = memo.discount;
                paidAmountInput.value = memo.paidAmount || 0;

                productTableBody.innerHTML = '';
                memo.products.forEach(product => addTableRow(product));
                updateTotals();
            }
        }

        /**
         * বিক্রয় রিপোর্ট মোডাল প্রদর্শন করে।
         */
        function showSalesReport() {
            showPasswordPrompt(() => {
                salesReportModal.style.display = 'flex';
                reportEndDateInput.value = getTodayDate();
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                const yyyy = thirtyDaysAgo.getFullYear();
                const mm = String(thirtyDaysAgo.getMonth() + 1).padStart(2, '0');
                const dd = String(thirtyDaysAgo.getDate()).padStart(2, '0');
                reportStartDateInput.value = `${yyyy}-${mm}-${dd}`;

                generateSalesReport();
            });
        }

        /**
         * নির্বাচিত তারিখের উপর ভিত্তি করে বিক্রয় রিপোর্ট তৈরি করে এবং প্রদর্শন করে।
         */
        function generateSalesReport() {
            const startDate = new Date(reportStartDateInput.value);
            const endDate = new Date(reportEndDateInput.value);
            endDate.setHours(23, 59, 59, 999);

            reportContentDiv.innerHTML = '';
            let dailySales = {};
            let totalSales = 0;

            memoHistory.forEach(memo => {
                const memoDate = new Date(memo.date);
                if (memoDate >= startDate && memoDate <= endDate) {
                    const dateKey = memoDate.toISOString().split('T')[0];
                    dailySales[dateKey] = (dailySales[dateKey] || 0) + memo.grandTotal;
                    totalSales += memo.grandTotal;
                }
            });

            const sortedDates = Object.keys(dailySales).sort();

            if (sortedDates.length === 0) {
                reportContentDiv.innerHTML = `<p class="text-gray-500 p-4">${translations[currentLanguage].noHistoryFound}</p>`;
                return;
            }

            let reportHtml = `<h3 class="text-xl font-bold mb-2">${translations[currentLanguage].grandTotalLabel}: ${totalSales.toFixed(2)}</h3>`;
            reportHtml += `<ul class="list-disc pl-5">`;
            sortedDates.forEach(date => {
                reportHtml += `<li>${date}: ${dailySales[date].toFixed(2)}</li>`;
            });
            reportHtml += `</ul>`;
            reportContentDiv.innerHTML = reportHtml;
        }

        /**
         * বিক্রয় রিপোর্ট প্রিন্ট করে।
         */
        function printReport() {
            const reportContent = document.getElementById('reportContent').innerHTML;
            const originalBody = document.body.innerHTML;
            document.body.innerHTML = `
                <div style="font-family: 'Noto Sans Bengali', sans-serif; padding: 20px;">
                    <h2 style="text-align: center; font-size: 24px; margin-bottom: 20px;">${translations[currentLanguage].salesReportTitle}</h2>
                    ${reportContent}
                </div>
            `;
            window.print();
            document.body.innerHTML = originalBody; // প্রিন্টের পর আসল কন্টেন্ট পুনরুদ্ধার করুন
            // HTML কন্টেন্ট পুনরুদ্ধার করার পর ইভেন্ট লিসেনার পুনরায় সংযুক্ত করুন
            attachEventListeners();
            applyTranslations(); // উপাদানগুলি পুনরায় রেন্ডার হওয়ায় অনুবাদ পুনরায় প্রয়োগ করুন
        }

        /**
         * পাসওয়ার্ড পরিবর্তন মোডাল প্রদর্শন করে।
         */
        function showChangePasswordModal() {
            oldPasswordInput.value = '';
            newPasswordInput.value = '';
            confirmNewPasswordInput.value = '';
            changePasswordError.classList.add('hidden');
            changePasswordModal.style.display = 'flex';
        }

        /**
         * পাসওয়ার্ড পরিবর্তনের লজিক পরিচালনা করে।
         */
        function handleChangePassword() {
            const oldPass = oldPasswordInput.value;
            const newPass = newPasswordInput.value;
            const confirmNewPass = confirmNewPasswordInput.value;

            if (oldPass !== HISTORY_PASSWORD) {
                changePasswordError.textContent = translations[currentLanguage].passwordError;
                changePasswordError.classList.remove('hidden');
                return;
            }

            if (newPass !== confirmNewPass) {
                changePasswordError.textContent = translations[currentLanguage].passwordMismatch;
                changePasswordError.classList.remove('hidden');
                return;
            }

            if (newPass.length < 4) {
                changePasswordError.textContent = "পাসওয়ার্ড কমপক্ষে ৪ অক্ষরের হতে হবে।";
                changePasswordError.classList.remove('hidden');
                return;
            }

            HISTORY_PASSWORD = newPass;
            localStorage.setItem('historyPassword', newPass);
            changePasswordModal.style.display = 'none';
            showMessage(translations[currentLanguage].passwordChangedSuccess, translations[currentLanguage].passwordChangedSuccess, 'success');
        }

        /**
         * কাস্টমার ম্যানেজমেন্ট ফাংশনসমূহ
         */

        /**
         * লোকাল স্টোরেজ থেকে কাস্টমার ডিরেক্টরি লোড করে।
         */
        function loadCustomerDirectory() {
            customerDirectory = JSON.parse(localStorage.getItem('customerDirectory')) || [];
            populateCustomerDatalist();
            populateCustomerTable();
        }

        /**
         * কাস্টমার ডিরেক্টরি লোকাল স্টোরেজে সংরক্ষণ করে।
         */
        function saveCustomerDirectory() {
            localStorage.setItem('customerDirectory', JSON.stringify(customerDirectory));
            populateCustomerDatalist();
            populateCustomerTable();
        }

        /**
         * ডিরেক্টরিতে একজন কাস্টমারকে আপডেট বা যোগ করে।
         * @param {Object} customerData - আপডেট/যোগ করার জন্য কাস্টমার ডেটা।
         */
        function updateCustomerDirectory(customerData) {
            const existingCustomerIndex = customerDirectory.findIndex(c => c.name === customerData.name);
            if (existingCustomerIndex > -1) {
                customerDirectory[existingCustomerIndex] = customerData;
            } else {
                customerDirectory.push(customerData);
            }
            saveCustomerDirectory();
        }

        /**
         * স্বয়ংক্রিয়-সম্পূর্ণতার জন্য কাস্টমার ডেটালিস্ট পূরণ করে।
         */
        function populateCustomerDatalist() {
            customerNamesDatalist.innerHTML = '';
            customerDirectory.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.name;
                customerNamesDatalist.appendChild(option);
            });
        }

        /**
         * কাস্টমার ম্যানেজমেন্ট টেবিল পূরণ করে।
         */
        function populateCustomerTable() {
            customerTableBody.innerHTML = '';
            customerDirectory.forEach((customer, index) => {
                const row = customerTableBody.insertRow();
                row.innerHTML = `
                    <td class="py-2 px-4">${index + 1}</td> <!-- ক্রমিক নং -->
                    <td class="py-2 px-4">${customer.name}</td>
                    <td class="py-2 px-4">${customer.address}</td>
                    <td class="py-2 px-4">${customer.mobile}</td>
                    <td class="py-2 px-4">
                        <button class="btn btn-info btn-xs mr-2 edit-customer-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-xs delete-customer-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
            });

            document.querySelectorAll('.edit-customer-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.dataset.index;
                    const customer = customerDirectory[index];
                    customerIdInput.value = index;
                    customerMgtNameInput.value = customer.name;
                    customerMgtAddressInput.value = customer.address;
                    customerMgtMobileInput.value = customer.mobile;
                });
            });

            document.querySelectorAll('.delete-customer-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.dataset.index;
                    if (confirm(translations[currentLanguage].customerDeleteConfirm)) {
                        customerDirectory.splice(index, 1);
                        saveCustomerDirectory();
                    }
                });
            });
        }

        /**
         * পণ্য ম্যানেজমেন্ট ফাংশনসমূহ
         */

        /**
         * লোকাল স্টোরেজ থেকে পণ্য ডিরেক্টরি এবং স্টক লগ লোড করে।
         */
        function loadProductDirectory() {
            productDirectory = JSON.parse(localStorage.getItem('productDirectory')) || [];
            stockLog = JSON.parse(localStorage.getItem('stockLog')) || [];
            populateProductDatalist();
            populateProductTable();
        }

        /**
         * পণ্য ডিরেক্টরি লোকাল স্টোরেজে সংরক্ষণ করে।
         */
        function saveProductDirectory() {
            localStorage.setItem('productDirectory', JSON.stringify(productDirectory));
            populateProductDatalist();
            populateProductTable();
        }

        /**
         * স্টক লগ লোকাল স্টোরেজে সংরক্ষণ করে।
         */
        function saveStockLog() {
            localStorage.setItem('stockLog', JSON.stringify(stockLog));
        }

        /**
         * স্বয়ংক্রিয়-সম্পূর্ণতার জন্য পণ্য ডেটালিস্ট পূরণ করে (বিবরণ এবং কোড)।
         */
        function populateProductDatalist() {
            let productDescriptionsAndCodesDatalist = document.getElementById('productDescriptionsAndCodes');
            if (!productDescriptionsAndCodesDatalist) {
                productDescriptionsAndCodesDatalist = document.createElement('datalist');
                productDescriptionsAndCodesDatalist.id = 'productDescriptionsAndCodes';
                document.body.appendChild(productDescriptionsAndCodesDatalist);
            }
            productDescriptionsAndCodesDatalist.innerHTML = '';
            productDirectory.forEach(product => {
                // বিবরণের জন্য অপশন
                const optionDesc = document.createElement('option');
                optionDesc.value = product.description;
                optionDesc.textContent = `${product.description} ${product.currentStock <= 0 ? translations[currentLanguage].outOfStock : ''}`;
                if (product.currentStock <= 0) {
                    optionDesc.disabled = true;
                }
                productDescriptionsAndCodesDatalist.appendChild(optionDesc);

                // পণ্য কোডের জন্য অপশন
                if (product.code) {
                    const optionCode = document.createElement('option');
                    optionCode.value = product.code;
                    optionCode.textContent = `${product.code} (${product.description}) ${product.currentStock <= 0 ? translations[currentLanguage].outOfStock : ''}`;
                    if (product.currentStock <= 0) {
                        optionCode.disabled = true;
                    }
                    productDescriptionsAndCodesDatalist.appendChild(optionCode);
                }
            });
        }

        /**
         * পণ্য ম্যানেজমেন্ট টেবিল পূরণ করে।
         */
        function populateProductTable() {
            productTableBodyMgt.innerHTML = '';
            productDirectory.forEach((product, index) => {
                const row = productTableBodyMgt.insertRow();
                const stockClass = product.currentStock < 10 ? 'low-stock' : ''; // কম স্টকের জন্য ক্লাস প্রয়োগ করুন
                row.innerHTML = `
                    <td class="py-2 px-4">${index + 1}</td> <!-- ক্রমিক নং -->
                    <td class="py-2 px-4">${product.code || ''}</td>
                    <td class="py-2 px-4 flex items-center">
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.description}" class="product-image-preview">` : `<img src="https://placehold.co/40x40/cccccc/ffffff?text=${translations[currentLanguage].noImageAvailable}" alt="No Image" class="product-image-preview">`}
                        ${product.description}
                    </td>
                    <td class="py-2 px-4">${(product.purchaseRate || 0).toFixed(2)}</td>
                    <td class="py-2 px-4">${(product.sellingRate || 0).toFixed(2)}</td>
                    <td class="py-2 px-4 ${stockClass}">${product.currentStock}</td>
                    <td class="py-2 px-4">
                        <button class="btn btn-info btn-xs mr-2 edit-product-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-xs delete-product-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                        <button class="btn btn-secondary btn-xs stock-history-btn mt-1" data-product-id="${product.id}" data-product-name="${product.description}"><i class="fas fa-history"></i></button>
                    </td>
                `;
            });

            document.querySelectorAll('.edit-product-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.dataset.index;
                    const product = productDirectory[index];
                    productIdInput.value = index;
                    productMgtCodeInput.value = product.code || '';
                    productMgtDescriptionInput.value = product.description;
                    productMgtPurchaseRateInput.value = product.purchaseRate || 0;
                    productMgtRateInput.value = product.sellingRate || 0;
                    productMgtStockInput.value = 0; // যোগ করার জন্য স্টক, বর্তমান স্টক নয়
                    productMgtImageUrlInput.value = product.imageUrl || '';
                });
            });

            document.querySelectorAll('.delete-product-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = e.target.dataset.index;
                    if (confirm(translations[currentLanguage].productDeleteConfirm)) {
                        // সম্পর্কিত স্টক লগ এন্ট্রিগুলিও সরান (ঐচ্ছিক, ডেটা ধরে রাখার ইচ্ছার উপর নির্ভর করে)
                        const productIdToDelete = productDirectory[index].id;
                        stockLog = stockLog.filter(log => log.productId !== productIdToDelete);
                        saveStockLog();

                        productDirectory.splice(index, 1);
                        saveProductDirectory();
                    }
                });
            });

            document.querySelectorAll('.stock-history-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.currentTarget.dataset.productId;
                    const productName = e.currentTarget.dataset.productName;
                    showStockHistory(productId, productName);
                });
            });
        }

        /**
         * পণ্য ম্যানেজমেন্ট মোডালে একটি পণ্য সংরক্ষণ/আপডেট পরিচালনা করে।
         */
        function handleProductFormSubmit(e) {
            e.preventDefault();
            const id = productIdInput.value;
            const code = productMgtCodeInput.value.trim();
            const description = productMgtDescriptionInput.value.trim();
            const purchaseRate = parseFloat(productMgtPurchaseRateInput.value) || 0;
            const sellingRate = parseFloat(productMgtRateInput.value) || 0;
            const stockToAdd = parseInt(productMgtStockInput.value) || 0;
            const imageUrl = productMgtImageUrlInput.value.trim();
            const today = getTodayDate();

            if (!code || !description || sellingRate <= 0) {
                showMessage("ত্রুটি", "প্রোডাক্ট কোড, বিবরণ এবং বিক্রয় দাম সঠিকভাবে পূরণ করুন।", 'error');
                return;
            }

            let existingProductIndex = -1;
            if (id) { // একটি বিদ্যমান পণ্য সম্পাদনা করা
                existingProductIndex = parseInt(id);
            } else { // একটি নতুন পণ্য যোগ করা বা কোড/বিবরণ দ্বারা আপডেট করা
                existingProductIndex = productDirectory.findIndex(p => p.code === code || p.description === description);
            }

            if (existingProductIndex > -1) {
                const existingProduct = productDirectory[existingProductIndex];
                // বিদ্যমান পণ্যের বিবরণ আপডেট করুন
                existingProduct.code = code;
                existingProduct.description = description;
                existingProduct.purchaseRate = purchaseRate;
                existingProduct.sellingRate = sellingRate;
                existingProduct.imageUrl = imageUrl;

                // স্টক যোগ করুন এবং লগ করুন
                if (stockToAdd > 0) {
                    existingProduct.currentStock += stockToAdd;
                    stockLog.push({
                        productId: existingProduct.id,
                        date: today,
                        type: 'in',
                        quantity: stockToAdd,
                        memoNo: null // স্টক-ইন এর জন্য কোনো মেমো নেই
                    });
                    saveStockLog();
                }
                showMessage(translations[currentLanguage].productUpdated, translations[currentLanguage].productUpdated, 'success');
            } else {
                // নতুন পণ্য যোগ করুন
                const newProductId = Date.now().toString(); // সহজ অনন্য আইডি
                productDirectory.push({
                    id: newProductId,
                    code: code,
                    description: description,
                    purchaseRate: purchaseRate,
                    sellingRate: sellingRate,
                    currentStock: stockToAdd,
                    imageUrl: imageUrl
                });
                // প্রাথমিক স্টককে স্টক-ইন হিসাবে লগ করুন
                if (stockToAdd > 0) {
                    stockLog.push({
                        productId: newProductId,
                        date: today,
                        type: 'in',
                        quantity: stockToAdd,
                        memoNo: null
                    });
                    saveStockLog();
                }
                showMessage(translations[currentLanguage].productAdded, translations[currentLanguage].productAdded, 'success');
            }
            saveProductDirectory();
            productForm.reset();
            productIdInput.value = '';
            productMgtStockInput.value = 0; // যোগ করার জন্য স্টক 0 তে রিসেট করুন
            productMgtImageUrlInput.value = ''; // ছবির URL ইনপুট রিসেট করুন
        }

        /**
         * একটি প্রদত্ত পণ্যের জন্য স্টক ইতিহাস প্রদর্শন করে।
         * @param {string} productId - পণ্যের আইডি।
         * @param {string} productName - পণ্যের নাম।
         */
        function showStockHistory(productId, productName) {
            stockHistoryProductName.textContent = `${productName} (${translations[currentLanguage].stockHistoryTitle})`;
            stockHistoryTableBody.innerHTML = '';

            const filteredStockHistory = stockLog.filter(log => log.productId === productId)
                                                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredStockHistory.length === 0) {
                stockHistoryTableBody.innerHTML = `<tr><td colspan="4" class="py-2 px-4 text-center text-gray-500">কোনো স্টক ইতিহাস পাওয়া যায়নি।</td></tr>`;
            } else {
                filteredStockHistory.forEach(log => {
                    const row = stockHistoryTableBody.insertRow();
                    row.innerHTML = `
                        <td class="py-2 px-4">${log.date}</td>
                        <td class="py-2 px-4">${log.type === 'in' ? 'স্টক ইন' : 'স্টক আউট'}</td>
                        <td class="py-2 px-4">${log.quantity}</td>
                        <td class="py-2 px-4">${log.memoNo || '-'}</td>
                    `;
                });
            }
            stockHistoryModal.style.display = 'flex';
        }


        /**
         * ড্যাশবোর্ড ফাংশনসমূহ (ব্যাপক ড্যাশবোর্ডের জন্য আপডেট করা হয়েছে)
         */

        /**
         * বর্তমান পরিসংখ্যান সহ ব্যাপক ড্যাশবোর্ড আপডেট করে।
         */
        function updateDashboard() {
            totalMemosValue.textContent = memoHistory.length;
            totalCustomersValue.textContent = customerDirectory.length;
            totalProductsValue.textContent = productDirectory.length;

            let totalSalesAmount = 0;
            memoHistory.forEach(memo => {
                totalSalesAmount += memo.grandTotal;
            });
            totalSalesAmountValue.textContent = totalSalesAmount.toFixed(2);

            // ড্যাশবোর্ডে পণ্যের স্টক পূরণ করুন
            dashboardProductStockTableBody.innerHTML = '';
            productDirectory.forEach(product => {
                const row = dashboardProductStockTableBody.insertRow();
                const stockClass = product.currentStock < 10 ? 'low-stock' : ''; // কম স্টকের জন্য ক্লাস প্রয়োগ করুন
                row.innerHTML = `
                    <td class="py-2 px-4 flex items-center">
                        ${product.imageUrl ? `<img src="${product.imageUrl}" alt="${product.description}" class="product-image-preview">` : `<img src="https://placehold.co/40x40/cccccc/ffffff?text=${translations[currentLanguage].noImageAvailable}" alt="No Image" class="product-image-preview">`}
                        ${product.description}
                    </td>
                    <td class="py-2 px-4">${(product.sellingRate || 0).toFixed(2)}</td>
                    <td class="py-2 px-4 ${stockClass}">${product.currentStock}</td>
                `;
            });
        }

        /**
         * ডেটা ইম্পোর্ট/এক্সপোর্ট ফাংশনসমূহ
         */

        /**
         * সমস্ত অ্যাপ্লিকেশন ডেটা একটি JSON ফাইলে এক্সপোর্ট করে।
         */
        function exportAllData() {
            showPasswordPrompt(() => {
                try {
                    const dataToExport = {
                        memoHistory: memoHistory,
                        customerDirectory: customerDirectory,
                        productDirectory: productDirectory,
                        stockLog: stockLog, // স্টক লগ অন্তর্ভুক্ত করুন
                        accountingEntries: accountingEntries, // নতুন: অ্যাকাউন্টিং এন্ট্রি অন্তর্ভুক্ত করুন
                        lastMemoNumber: lastMemoNumber,
                        historyPassword: HISTORY_PASSWORD // সম্পূর্ণ ব্যাকআপের জন্য পাসওয়ার্ড এক্সপোর্ট করুন
                    };
                    const dataStr = JSON.stringify(dataToExport, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cash_memo_data_${getTodayDate()}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showMessage(translations[currentLanguage].exportSuccess, translations[currentLanguage].exportSuccess, 'success');
                } catch (error) {
                    console.error("ডেটা এক্সপোর্ট করতে ত্রুটি:", error);
                    showMessage(translations[currentLanguage].exportError, translations[currentLanguage].exportError, 'error');
                }
            });
        }

        /**
         * লুকানো ফাইল ইনপুট ট্রিগার করে ইম্পোর্ট প্রক্রিয়া শুরু করে।
         */
        function importData() {
            showPasswordPrompt(() => {
                importFileInput.click();
            });
        }

        /**
         * ইম্পোর্টের জন্য নির্বাচিত ফাইল পরিচালনা করে।
         * @param {Event} event - ফাইল ইনপুট পরিবর্তন ইভেন্ট।
         */
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (importedData.memoHistory && importedData.customerDirectory && importedData.productDirectory && typeof importedData.lastMemoNumber === 'number') {
                            localStorage.setItem('memoHistory', JSON.stringify(importedData.memoHistory));
                            localStorage.setItem('customerDirectory', JSON.stringify(importedData.customerDirectory));
                            localStorage.setItem('productDirectory', JSON.stringify(importedData.productDirectory));
                            localStorage.setItem('lastMemoNumber', importedData.lastMemoNumber);
                            if (importedData.stockLog) { // স্টক লগ উপলব্ধ থাকলে ইম্পোর্ট করুন
                                localStorage.setItem('stockLog', JSON.stringify(importedData.stockLog));
                            }
                            if (importedData.accountingEntries) { // নতুন: অ্যাকাউন্টিং এন্ট্রি উপলব্ধ থাকলে ইম্পোর্ট করুন
                                localStorage.setItem('accountingEntries', JSON.stringify(importedData.accountingEntries));
                            }
                            if (importedData.historyPassword) {
                                localStorage.setItem('historyPassword', importedData.historyPassword);
                                HISTORY_PASSWORD = importedData.historyPassword; // রানটাইম পাসওয়ার্ড আপডেট করুন
                            }

                            // সমস্ত ডেটা পুনরায় লোড করুন এবং UI রিফ্রেশ করুন
                            memoHistory = importedData.memoHistory;
                            customerDirectory = importedData.customerDirectory;
                            productDirectory = importedData.productDirectory;
                            stockLog = importedData.stockLog || []; // stockLog ইনিশিয়ালাইজ করা নিশ্চিত করুন
                            accountingEntries = importedData.accountingEntries || []; // নতুন: accountingEntries ইনিশিয়ালাইজ করা নিশ্চিত করুন
                            lastMemoNumber = importedData.lastMemoNumber;

                            refreshMemo(); // ফর্ম রিসেট করুন এবং নতুন lastMemoNumber এর উপর ভিত্তি করে মেমো নম্বর পুনরায় তৈরি করুন
                            loadCustomerDirectory(); // ডেটালিস্ট/টেবিল আপডেট করতে গ্রাহকদের পুনরায় লোড করুন
                            loadProductDirectory(); // ডেটালিস্ট/টেবিল আপডেট করতে পণ্য পুনরায় লোড করুন
                            updateDashboard(); // নতুন ডেটা দিয়ে ড্যাশবোর্ড আপডেট করুন
                            showMessage(translations[currentLanguage].importSuccess, translations[currentLanguage].importSuccess, 'success');
                        } else {
                            throw new Error("অবৈধ ডেটা কাঠামো।");
                        }
                    } catch (error) {
                        console.error("ডেটা ইম্পোর্ট করতে ত্রুটি:", error);
                        showMessage(translations[currentLanguage].importError, translations[currentLanguage].importError, 'error');
                    }
                };
                reader.readAsText(file);
            }
        }

        /**
         * অ্যাকাউন্টিং ফাংশনসমূহ
         */

        /**
         * অ্যাকাউন্টিং এন্ট্রি লোড করে এবং UI আপডেট করে।
         */
        function loadAccountingEntries() {
            accountingEntries = JSON.parse(localStorage.getItem('accountingEntries')) || [];
            updateAccountingSlNo();
            generateAccountingReport(); // ডিফল্টভাবে 7 দিনের রিপোর্ট দেখান
        }

        /**
         * অ্যাকাউন্টিং এন্ট্রি লোকাল স্টোরেজে সংরক্ষণ করে।
         */
        function saveAccountingEntries() {
            localStorage.setItem('accountingEntries', JSON.stringify(accountingEntries));
            updateAccountingSlNo();
            generateAccountingReport();
        }

        /**
         * অ্যাকাউন্টিং ফর্মের ক্রমিক নম্বর আপডেট করে।
         */
        function updateAccountingSlNo() {
            accountingSlNoInput.value = accountingEntries.length + 1;
        }

        /**
         * একটি নতুন আয়-ব্যয় এন্ট্রি যোগ করে।
         */
        function addAccountingEntry(e) {
            e.preventDefault();
            const date = accountingDateInput.value;
            const income = parseFloat(accountingIncomeInput.value) || 0;
            const expense = parseFloat(accountingExpenseInput.value) || 0;
            const expenseCategory = accountingExpenseCategoryInput.value.trim();
            const comment = accountingCommentInput.value.trim();

            if (!date) {
                showMessage("ত্রুটি", "তারিখ নির্বাচন করুন।", 'error');
                return;
            }
            if (income === 0 && expense === 0) {
                showMessage("ত্রুটি", "আয় অথবা ব্যয় ইনপুট করুন।", 'error');
                return;
            }

            const newEntry = {
                id: Date.now(), // অনন্য আইডি
                date: date,
                income: income,
                expense: expense,
                expenseCategory: expenseCategory,
                comment: comment,
                timestamp: new Date().toISOString()
            };

            accountingEntries.push(newEntry);
            saveAccountingEntries();
            accountingForm.reset();
            accountingIncomeInput.value = 0;
            accountingExpenseInput.value = 0;
            accountingDateInput.value = getTodayDate(); // আজকের তারিখ সেট করুন
            updateAccountingSlNo();
            showMessage(translations[currentLanguage].entryAddedSuccess, translations[currentLanguage].entryAddedSuccess, 'success');
        }

        /**
         * একটি নির্দিষ্ট অ্যাকাউন্টিং এন্ট্রি মুছে ফেলে।
         * @param {number} entryId - মুছে ফেলার জন্য এন্ট্রির আইডি।
         */
        function deleteAccountingEntry(entryId) {
            if (confirm(translations[currentLanguage].deleteEntryConfirm)) {
                accountingEntries = accountingEntries.filter(entry => entry.id !== entryId);
                saveAccountingEntries();
                showMessage(translations[currentLanguage].entryDeletedSuccess, translations[currentLanguage].entryDeletedSuccess, 'success');
            }
        }

        /**
         * অ্যাকাউন্টিং রিপোর্ট তৈরি করে এবং প্রদর্শন করে।
         */
        function generateAccountingReport() {
            const startDate = new Date(accountingReportStartDateInput.value);
            const endDate = new Date(accountingReportEndDateInput.value);
            endDate.setHours(23, 59, 59, 999); // দিনের শেষ পর্যন্ত অন্তর্ভুক্ত করতে

            accountingReportContent.innerHTML = '';
            let filteredEntries = accountingEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate >= startDate && entryDate <= endDate;
            }).sort((a, b) => new Date(a.date) - new Date(b.date)); // তারিখ অনুযায়ী সাজান

            if (filteredEntries.length === 0) {
                accountingReportContent.innerHTML = `<p class="text-gray-500 p-4">${translations[currentLanguage].noAccountingEntries}</p>`;
                return;
            }

            let totalIncome = 0;
            let totalExpense = 0;

            let reportHtml = `
                <div class="overflow-x-auto mb-4">
                    <table class="min-w-full bg-white rounded-lg shadow-sm text-sm">
                        <thead>
                            <tr>
                                <th class="py-2 px-3 text-left">${translations[currentLanguage].slNoHeader}</th>
                                <th class="py-2 px-3 text-left">${translations[currentLanguage].dateLabel}</th>
                                <th class="py-2 px-3 text-right">${translations[currentLanguage].incomeLabel}</th>
                                <th class="py-2 px-3 text-right">${translations[currentLanguage].expenseLabel}</th>
                                <th class="py-2 px-3 text-left">${translations[currentLanguage].expenseCategoryLabel}</th>
                                <th class="py-2 px-3 text-left">${translations[currentLanguage].commentLabel}</th>
                                <th class="py-2 px-3 text-center print-hidden">${translations[currentLanguage].actionHeader}</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            filteredEntries.forEach((entry, index) => {
                totalIncome += entry.income;
                totalExpense += entry.expense;
                reportHtml += `
                    <tr class="border-b border-gray-200">
                        <td class="py-1.5 px-3 text-center">${index + 1}</td>
                        <td class="py-1.5 px-3">${entry.date}</td>
                        <td class="py-1.5 px-3 text-right">${entry.income.toFixed(2)}</td>
                        <td class="py-1.5 px-3 text-right">${entry.expense.toFixed(2)}</td>
                        <td class="py-1.5 px-3">${entry.expenseCategory || '-'}</td>
                        <td class="py-1.5 px-3">${entry.comment || '-'}</td>
                        <td class="py-1.5 px-3 text-center print-hidden">
                            <button class="delete-accounting-entry-btn btn-danger text-white p-1.5 rounded-full text-xs" data-entry-id="${entry.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            const netBalance = totalIncome - totalExpense;

            reportHtml += `
                        </tbody>
                    </table>
                </div>
                <div class="flex justify-end mt-4">
                    <div class="w-full md:w-1/2 bg-gray-100 p-4 rounded-lg shadow-sm">
                        <p class="text-lg font-bold mb-2">${translations[currentLanguage].totalIncome} <span class="float-right text-green-700">${totalIncome.toFixed(2)}</span></p>
                        <p class="text-lg font-bold mb-2">${translations[currentLanguage].totalExpense} <span class="float-right text-red-700">${totalExpense.toFixed(2)}</span></p>
                        <p class="text-xl font-extrabold border-t-2 border-gray-300 pt-2 mt-2">
                            ${translations[currentLanguage].netBalance}
                            <span class="float-right ${netBalance >= 0 ? 'text-blue-700' : 'text-red-700'}">${netBalance.toFixed(2)}</span>
                        </p>
                    </div>
                </div>
            `;
            accountingReportContent.innerHTML = reportHtml;

            // ডিলিট বাটনের জন্য ইভেন্ট লিসেনার যোগ করুন
            document.querySelectorAll('.delete-accounting-entry-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const entryId = parseInt(e.currentTarget.dataset.entryId);
                    deleteAccountingEntry(entryId);
                });
            });
        }

        /**
         * অ্যাকাউন্টিং রিপোর্ট প্রিন্ট করে।
         */
        function printAccountingReport() {
            const reportContent = document.getElementById('accountingReportContent').innerHTML;
            const originalBody = document.body.innerHTML;
            document.body.innerHTML = `
                <div style="font-family: 'Noto Sans Bengali', sans-serif; padding: 20px;">
                    <h2 style="text-align: center; font-size: 24px; margin-bottom: 20px;">${translations[currentLanguage].accountingReportTitle}</h2>
                    ${reportContent}
                </div>
            `;
            window.print();
            document.body.innerHTML = originalBody; // প্রিন্টের পর আসল কন্টেন্ট পুনরুদ্ধার করুন
            attachEventListeners();
            applyTranslations();
        }

        /**
         * সমস্ত প্রয়োজনীয় ইভেন্ট লিসেনার সংযুক্ত করে।
         * এই ফাংশনটি প্রাথমিক লোডে এবং HTML কন্টেন্ট পুনরুদ্ধার করার পরে (যেমন প্রিন্টের পরে) কল করা হয়।
         */
        function attachEventListeners() {
            if (languageToggle) languageToggle.addEventListener('click', toggleLanguage);
            if (manualMemoNoToggleBtn) manualMemoNoToggleBtn.addEventListener('click', toggleManualMemoNo);
            if (addProductBtn) addProductBtn.addEventListener('click', () => addTableRow());
            if (discountInput) discountInput.addEventListener('input', updateTotals);
            if (paidAmountInput) paidAmountInput.addEventListener('input', updateTotals);

            // সাইডবার বাটন
            if (saveMemoBtn) saveMemoBtn.addEventListener('click', saveMemo);
            if (printMemoBtn) printMemoBtn.addEventListener('click', printMemo);
            if (refreshMemoBtn) refreshMemoBtn.addEventListener('click', refreshMemo);
            if (homeBtn) homeBtn.addEventListener('click', () => { // হোম বাটন এখন মেমো জেনারেটর দেখায়
                dashboardModal.style.display = 'none'; // ড্যাশবোর্ড খোলা থাকলে লুকান
                accountingModal.style.display = 'none'; // অ্যাকাউন্টিং মোডাল খোলা থাকলে লুকান
                mainContentWrapper.classList.remove('hidden'); // মেমো জেনারেটর দেখান
                refreshMemo(); // মেমো নতুন আছে তা নিশ্চিত করুন
            });
            if (dashboardBtnMain) { // সাইডবারে ড্যাশবোর্ড বাটন
                dashboardBtnMain.addEventListener('click', () => {
                    showPasswordPrompt(() => {
                        mainContentWrapper.classList.add('hidden'); // মেমো জেনারেটর লুকান
                        accountingModal.style.display = 'none'; // অ্যাকাউন্টিং মোডাল খোলা থাকলে লুকান
                        dashboardModal.style.display = 'flex';
                        updateDashboard(); // ড্যাশবোর্ডের ডেটা নতুন আছে তা নিশ্চিত করুন
                    });
                });
            }
            if (accountingBtn) accountingBtn.addEventListener('click', () => { // নতুন: অ্যাকাউন্টিং বাটন
                showPasswordPrompt(() => {
                    mainContentWrapper.classList.add('hidden'); // মেমো জেনারেটর লুকান
                    dashboardModal.style.display = 'none'; // ড্যাশবোর্ড খোলা থাকলে লুকান
                    accountingModal.style.display = 'flex';
                    accountingDateInput.value = getTodayDate(); // আজকের তারিখ সেট করুন
                    updateAccountingSlNo();
                    // ডিফল্টভাবে গত 7 দিনের রিপোর্ট দেখান
                    const endDate = new Date(getTodayDate());
                    const startDate = new Date(endDate);
                    startDate.setDate(endDate.getDate() - 6); // গত 7 দিন
                    accountingReportStartDateInput.value = startDate.toISOString().split('T')[0];
                    accountingReportEndDateInput.value = endDate.toISOString().split('T')[0];
                    generateAccountingReport();
                });
            });
            if (historyBtn) historyBtn.addEventListener('click', showHistory);
            if (salesReportBtn) salesReportBtn.addEventListener('click', showSalesReport);
            if (manageCustomersBtn) manageCustomersBtn.addEventListener('click', () => {
                showPasswordPrompt(() => {
                    customerManagementModal.style.display = 'flex';
                    populateCustomerTable();
                    customerForm.reset();
                    customerIdInput.value = '';
                });
            });
            if (manageProductsBtn) manageProductsBtn.addEventListener('click', () => {
                showPasswordPrompt(() => {
                    productManagementModal.style.display = 'flex';
                    populateProductTable();
                    productForm.reset();
                    productIdInput.value = '';
                    productMgtStockInput.value = 0; // স্টক যোগ করার ফিল্ড রিসেট করুন
                    productMgtImageUrlInput.value = ''; // ছবির URL ইনপুট রিসেট করুন
                });
            });
            if (importDataBtn) importDataBtn.addEventListener('click', importData);
            if (exportDataBtn) exportDataBtn.addEventListener('click', exportAllData);
            if (changePasswordBtn) changePasswordBtn.addEventListener('click', showChangePasswordModal);
            if (developerInfoBtn) developerInfoBtn.addEventListener('click', () => developerInfoModal.style.display = 'flex');

            // মেমোর নিচের বাটন
            if (saveMemoBottomBtn) saveMemoBottomBtn.addEventListener('click', saveMemo);
            if (printMemoBottomBtn) printMemoBottomBtn.addEventListener('click', printMemo);
            if (resetMemoBottomBtn) resetMemoBottomBtn.addEventListener('click', refreshMemo);

            // মোডাল বন্ধ করার বাটন
            if (closeDashboardModal) closeDashboardModal.addEventListener('click', () => {
                dashboardModal.style.display = 'none';
                mainContentWrapper.classList.remove('hidden'); // ফিক্স: ড্যাশবোর্ড বন্ধ করার পর মেমো পেজ দেখান
            });
            if (historySearchInput) historySearchInput.addEventListener('input', (e) => loadHistoryList(e.target.value));
            if (closeHistoryModal) closeHistoryModal.addEventListener('click', () => historyModal.style.display = 'none');

            if (closeSalesReportModal) closeSalesReportModal.addEventListener('click', () => salesReportModal.style.display = 'none');
            if (generateReportBtn) generateReportBtn.addEventListener('click', generateSalesReport);
            if (printReportBtn) printReportBtn.addEventListener('click', printReport);

            if (closeChangePasswordModal) closeChangePasswordModal.addEventListener('click', () => changePasswordModal.style.display = 'none');
            if (changePasswordSubmitBtn) changePasswordSubmitBtn.addEventListener('click', handleChangePassword);
            if (changePasswordCancelBtn) changePasswordCancelBtn.addEventListener('click', () => changePasswordModal.style.display = 'none');

            if (closeCustomerManagementModal) closeCustomerManagementModal.addEventListener('click', () => customerManagementModal.style.display = 'none');
            if (customerForm) customerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = customerIdInput.value;
                const name = customerMgtNameInput.value;
                const address = customerMgtAddressInput.value;
                const mobile = customerMgtMobileInput.value;

                if (id) {
                    customerDirectory[id] = { name, address, mobile };
                    showMessage(translations[currentLanguage].customerUpdated, translations[currentLanguage].customerUpdated, 'success');
                } else {
                    customerDirectory.push({ name, address, mobile });
                    showMessage(translations[currentLanguage].customerAdded, translations[currentLanguage].customerAdded, 'success');
                }
                saveCustomerDirectory();
                customerForm.reset();
                customerIdInput.value = '';
            });

            if (closeProductManagementModal) closeProductManagementModal.addEventListener('click', () => productManagementModal.style.display = 'none');
            if (productForm) productForm.addEventListener('submit', handleProductFormSubmit);

            if (closeStockHistoryModal) closeStockHistoryModal.addEventListener('click', () => stockHistoryModal.style.display = 'none');

            if (closeDeveloperInfoModal) closeDeveloperInfoModal.addEventListener('click', () => developerInfoModal.style.display = 'none');

            // ড্যাশবোর্ডের দ্রুত লিঙ্ক লিসেনার (ড্যাশবোর্ড মোডালের ভিতরে)
            if (dashboardHistoryBtn) dashboardHistoryBtn.addEventListener('click', showHistory);
            if (dashboardSalesReportBtn) dashboardSalesReportBtn.addEventListener('click', showSalesReport);
            if (dashboardManageCustomersBtn) dashboardManageCustomersBtn.addEventListener('click', () => {
                showPasswordPrompt(() => {
                    customerManagementModal.style.display = 'flex';
                    populateCustomerTable();
                    customerForm.reset();
                    customerIdInput.value = '';
                });
            });
            if (dashboardManageProductsBtn) dashboardManageProductsBtn.addEventListener('click', () => {
                showPasswordPrompt(() => {
                    productManagementModal.style.display = 'flex';
                    populateProductTable();
                    productForm.reset();
                    productIdInput.value = '';
                    productMgtStockInput.value = 0;
                    productMgtImageUrlInput.value = '';
                });
            });
            if (importDataBtn) importDataBtn.addEventListener('click', importData);
            if (exportDataBtn) exportDataBtn.addEventListener('click', exportAllData);

            // সাধারণ মোডাল বন্ধ করার লিসেনার
            if (messageCloseBtn) messageCloseBtn.addEventListener('click', hideMessage);

            // ইম্পোর্টের জন্য লুকানো ফাইল ইনপুট পরিবর্তন লিসেনার
            if (importFileInput) importFileInput.addEventListener('change', handleImportFile);

            // নতুন অ্যাকাউন্টিং মোডালের ইভেন্ট লিসেনার
            if (closeAccountingModal) closeAccountingModal.addEventListener('click', () => {
                accountingModal.style.display = 'none';
                mainContentWrapper.classList.remove('hidden'); // অ্যাকাউন্টিং বন্ধ করার পর মেমো পেজ দেখান
            });
            if (accountingForm) accountingForm.addEventListener('submit', addAccountingEntry);
            if (accountingReportStartDateInput) accountingReportStartDateInput.addEventListener('change', generateAccountingReport);
            if (accountingReportEndDateInput) accountingReportEndDateInput.addEventListener('change', generateAccountingReport);
            if (accountingReport7DaysBtn) accountingReport7DaysBtn.addEventListener('click', () => {
                const endDate = new Date(getTodayDate());
                const startDate = new Date(endDate);
                startDate.setDate(endDate.getDate() - 6); // গত 7 দিন
                accountingReportStartDateInput.value = startDate.toISOString().split('T')[0];
                accountingReportEndDateInput.value = endDate.toISOString().split('T')[0];
                generateAccountingReport();
            });
            if (accountingReportThisMonthBtn) accountingReportThisMonthBtn.addEventListener('click', () => {
                const today = new Date(getTodayDate());
                const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                accountingReportStartDateInput.value = firstDayOfMonth.toISOString().split('T')[0];
                accountingReportEndDateInput.value = lastDayOfMonth.toISOString().split('T')[0];
                generateAccountingReport();
            });
            if (accountingReportLastMonthBtn) accountingReportLastMonthBtn.addEventListener('click', () => {
                const today = new Date(getTodayDate());
                const firstDayOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                const lastDayOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                accountingReportStartDateInput.value = firstDayOfLastMonth.toISOString().split('T')[0];
                accountingReportEndDateInput.value = lastDayOfLastMonth.toISOString().split('T')[0];
                generateAccountingReport();
            });
            if (generateAccountingReportBtn) generateAccountingReportBtn.addEventListener('click', generateAccountingReport);
            if (printAccountingReportBtn) printAccountingReportBtn.addEventListener('click', printAccountingReport);


            // বাইরে ক্লিক করলে মোডাল বন্ধ করুন
            window.addEventListener('click', (event) => {
                if (event.target == historyModal) {
                    historyModal.style.display = 'none';
                }
                if (event.target == salesReportModal) {
                    salesReportModal.style.display = 'none';
                }
                if (event.target == passwordModal) {
                    passwordModal.style.display = 'none';
                }
                if (event.target == changePasswordModal) {
                    changePasswordModal.style.display = 'none';
                }
                if (event.target == customerManagementModal) {
                    customerManagementModal.style.display = 'none';
                }
                if (event.target == productManagementModal) {
                    productManagementModal.style.display = 'none';
                }
                if (event.target == stockHistoryModal) {
                    stockHistoryModal.style.display = 'none';
                }
                if (event.target == dashboardModal) {
                    dashboardModal.style.display = 'none';
                    mainContentWrapper.classList.remove('hidden'); // ফিক্স: বাইরে ক্লিক করে ড্যাশবোর্ড বন্ধ করার পর মেমো পেজ দেখান
                }
                if (event.target == accountingModal) { // নতুন: অ্যাকাউন্টিং মোডাল বন্ধ করুন
                    accountingModal.style.display = 'none';
                    mainContentWrapper.classList.remove('hidden'); // অ্যাকাউন্টিং বন্ধ করার পর মেমো পেজ দেখান
                }
                if (event.target == developerInfoModal) {
                    developerInfoModal.style.display = 'none';
                }
                if (event.target == messageModal) {
                    hideMessage();
                }
            });

            // গ্রাহকের নাম ইনপুট পরিবর্তন লিসেনার স্বয়ংক্রিয়-পূরণ ঠিকানা/মোবাইলের জন্য
            if (customerNameInput) {
                customerNameInput.addEventListener('input', (e) => {
                    const selectedCustomerName = e.target.value;
                    const selectedCustomer = customerDirectory.find(c => c.name === selectedCustomerName);
                    if (selectedCustomer) {
                        customerAddressInput.value = selectedCustomer.address || '';
                        customerMobileInput.value = selectedCustomer.mobile || '';
                    } else {
                        // কোনো ম্যাচিং কাস্টমার না পাওয়া গেলে পরিষ্কার করুন
                        customerAddressInput.value = '';
                        customerMobileInput.value = '';
                    }
                });
            }
        }


        // প্রাথমিক লোড লজিক
        window.onload = () => {
            memoHistory = JSON.parse(localStorage.getItem('memoHistory')) || [];
            accountingEntries = JSON.parse(localStorage.getItem('accountingEntries')) || []; // নতুন: অ্যাকাউন্টিং এন্ট্রি লোড করুন
            loadCustomerDirectory();
            loadProductDirectory(); // পণ্য ডিরেক্টরি এবং স্টক লগ লোড করুন
            attachEventListeners(); // সমস্ত ইভেন্ট লিসেনার সংযুক্ত করুন
            applyTranslations();
            refreshMemo(); // মেমো নম্বর এবং তারিখ ইনিশিয়ালাইজ করুন, এবং প্রথম সারি যোগ করুন
            dashboardModal.style.display = 'none'; // নিশ্চিত করুন যে ড্যাশবোর্ড প্রাথমিকভাবে দেখানো হচ্ছে না
            accountingModal.style.display = 'none'; // নিশ্চিত করুন যে অ্যাকাউন্টিং মোডাল প্রাথমিকভাবে দেখানো হচ্ছে না
            mainContentWrapper.classList.remove('hidden'); // নিশ্চিত করুন যে মেমো পেজ প্রাথমিকভাবে দৃশ্যমান
            updateDashboard();
            updateAccountingSlNo(); // অ্যাকাউন্টিং সিরিয়াল নম্বর আপডেট করুন
            accountingDateInput.value = getTodayDate(); // অ্যাকাউন্টিং তারিখকে আজকের তারিখে সেট করুন
        };
    </script>
</body>
</html>